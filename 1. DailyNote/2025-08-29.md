
# 1. VỀ TIME 

5min lại = 35min luôn rồi ạ 😺


---
**Lần 1 estimate xong trong 2h, nhưng 6h mới xong (2h gen, 4h sửa+code update luồng)**

|   |   |   |   |   |   |   |   |   |   |   |
|---|---|---|---|---|---|---|---|---|---|---|
||Số situations  <br>(mỗi situation gồm 5 scenarios, mỗi senario 1 lúc gen 8 audios)|Số workers|Time tổng|Time trung bình|Số audios bị lỗi  <br>---  <br>=IF(ISNUMBER(SEARCH("NULL",Q2)),0,1)|Số Situation bị lỗi Lesson Detail bị lỗi (Bị thiếu 1/5-6 scenario)  <br>  <br>=COUNTIF(A:A, B2) > 0|Số Situations bị lỗi  <br>---  <br>"status": "error"|Tổng situations bị lỗi|Số Lesson Detail bị lỗi|Nguyên nhân lỗi|
|Lần 1|74|20|5.3 min|4.3 s/item|1|0||75|||
|Lần 2|244|40|9.4 min|2.3 s/item|205|2 (8585, 9659)|||2 cases khả năng cao do giới hạn OpenAI|
|Lần 3|217|40|10.1 min|2.8 s/item|233|5 (10054, 10058, 10072, 10094, 13292)|||- 1 case cụm cấu trúc không có ___  <br>- 4 cases khả năng cao do giới hạn OpenAI|
|Sum Đợt 1|535||||||||||
|Lần 4 (non work)|708|10|86.7|7.3s/item|12|5|0||||

  

|   |   |   |   |   |   |   |   |
|---|---|---|---|---|---|---|---|
|LỌC + GEN Situations có Audio bị lỗi (75 situations)|   |   |   |=> Code gen nhanh dựa vào 1 list _situation_id_____|   |   ||
|Merge situations lỗi vào chung|   |   |   |=> Code thêm phần để merge nhanh phần SITUATIONS GEN MỚI thay thế cho Situatons cũ|   |   ||
|Gen Situations bị thiếu (maybe do giới hạn OpenAI)|   |   |   ||   |   |code sau nếu có time|

|   |   |   |   |   |   |   |   |   |   |   |
|---|---|---|---|---|---|---|---|---|---|---|
||||1 Situations = 5 scenario * 8 audios|20 Situation|100 Situations|700 Situations|10K Situations|1 Job Roles = 10 Topics × 5 Situations = 50 situations|10 Job Roles = 500 Stuations|300 Collections × 10 Topics × 5 Situations = **15,000 Situations**|
|1. Dự kiến gen: 20 luồng 1 lúc => Lỗi situations dự kiến = 1%|   |   |1.5min|1.5min|7.5min|Thời gian chạy 10 worker = 86.7min, 20 worker = 43min.|750min ~ 12-13h|3.6min|36min ~ 40min|36min * 30 = 15h~18h < 24h|
|0. Lấy kết quả từ trên server xuống máy và ghi log time + MÁY LAG VÌ NHIỀU DÒNG QUÁ|   |   ||||15min qua github|||||
|2.  <br>Lọc các phần lỗi:  <br>+, Lọc Audio bị lỗi (do giới hạn API Audio)  <br>+, Lọc Scenario bị lỗi (giới hạn API OpenAI)|   |   |Làm tay 10 min|Làm tay 11 min|Làm tay 12 min|15min(Drive lâu)+25min(sau chuyển xuống local - excel nhanh)|Làm tay 20 min|Làm tay 14 min|Làm tay 15 min|Làm tay 20 min|
|3. Gen lại phần bị lỗi:  <br>+, Check xem còn bị thiếu không  <br>+, Merge phần bị lỗi vào phần gốc (đã oke) Thời gian để gen lại 1% Lỗi:|   |   |30min|31min|32min|40min|1% lỗi gen lại =1h|2h|35min|1% lỗi gen lại = 1.5h-2h|
|DỰ TRÙ|   |   |||||5H|2h|35min|8H|
|Sum|   |   |||SUM|43min gen + 1h rưỡi (xử lý và gen bổ sung)|15h-20H|2h|35min|20h-30H|

  

  

```Plain
nohup python main.py --start_situation 1000000001 --end_situation 1000000956 --input_file "29082025_GenMass_non_work_v2.xlsx" --max_workers 20 --batch_size 1 > situation_1000000001_1000000956.log 2> err_situation_1000000001_1000000956.log &

```

```JSON
{"status": "error", "text": "HTTPConnectionPool(host='103.253.20.30', port=3000): Max retries exceeded with url: /api/generate-learning-onion (Caused by ConnectTimeoutError(<urllib3.connection.HTTPConnection object at 0x00000221CA415CD0>, 'Connection to 103.253.20.30 timed out. (connect timeout=None)'))", "__request_payload__": {"inputForOnion": {"user_profile": "Full-stack Developer", "lesson": {"topic": "PHỐI HỢP TÍCH HỢP VỚI TEAM QA", "scenarios": [{"scenario": "Có một lỗi lạ chỉ xảy ra trên môi trường Production. Bạn cần nhờ DevOps truy cập server để lấy log giúp bạn phân tích.", "questions": ["What can I help you with?"]}, {"scenario": "Có một lỗi lạ chỉ xảy ra trên môi trường Production. Bạn cần nhờ DevOps truy cập server để lấy log giúp bạn phân tích.", "questions": ["Why do you need them?"]}, {"scenario": "Có một lỗi lạ chỉ xảy ra trên môi trường Production. Bạn cần nhờ DevOps truy cập server để lấy log giúp bạn phân tích.", "questions": ["What is the timeframe for the logs?"]}, {"scenario": "Có một lỗi lạ chỉ xảy ra trên môi trường Production. Bạn cần nhờ DevOps truy cập server để lấy log giúp bạn phân tích.", "questions": ["Do you know the specific service or container name?"]}]}}}, "internal_index": 7}
```

  

```Bash
Set-Location "D:\GIT\MiniProd_Web4_ContentEngFlow_StepUpE_T102024\1000Nghe_copyFrom_LS_ai_automation\utils_genLessonDetail1000Nghe_22082025_v2"
$env:PYTHONUTF8='1'; $env:PYTHONIOENCODING='utf-8'
$ids = @"
1000000010
1000000019
1000000055
1000000258
1000000286
1000000395
1000000410
1000000437
1000000541
1000000592
1000000638
1000000642
1000000704
1000000771
1000000825
1000000924
1000000955
"@
python .\main_run_specific_ids_parallel_and_merge.py --input_file "29082025_GenMass_non_work_v2.xlsx" --ids $ids --pool_workers 10 --per_run_max_workers 1 --output_prefix "output_pipeline_results" --merged_output "merged_all_1000000010.xlsx" --continue_on_error
```

  

**Report time gen non-work : số chính xác - 708 situations:** +, time gen: 86min (10 workers do đêm nên em gen thong thả) (20 worker như chiều qua thì 43min) +, Time xử lý phía sau: 1h rưỡi = lấy code từ serve => check audio -scenario - error => Gen lại => Check phần gen lại ouput 2 => merge output3 => Đẩy lên Drive cho a Trúc = 1h rưỡi. ---

=> Check update.

1. Lấy code từ server => Kaizen: ĐÓNG GÓI MỌI LỆNH
    

```Plain
git commit -m "[GEN MASS NON WORK - RESULTS - => Lần 4 (non work)708 situations - 10 worker - time 86.7

📌 Filtered to 708 situations (range: 1000000001 - 11000000001)

🚀 Bắt đầu chạy pipeline cho 708 situations...
🧵 Parallel Processing Mode:
   Max Workers: 10
   Batch Size: 1
🚀 Parallel Processing Setup:
   📊 Total items: 708
   📦 Batch size: 1
   �� Max workers: 10
   📋 Total batches: 708
   💾 Memory limit: 1024MB
   🔧 Adaptive mode: ✅

🎉 Parallel Processing Complete!
   ⏱️  Total time: 86.7 minutes
   📊 Success rate: 100.0%
   ❌ Errors: 0
   🔄 Retries: 0
   💾 Peak memory: 242.1MB
   🚀 Throughput: 0.14 items/second
✅ Pipeline xong, đã export ra output_pipeline_results_20250829_024730.xlsx
"

git stash
git pull 
git pop stash

---
```

|                                                                     |                                                                                                     |                                                      |
| ------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------- | ---------------------------------------------------- |
| Số audios bị lỗi  <br>---  <br>=IF(ISNUMBER(SEARCH("NULL",Q2)),0,1) | Số Situation bị lỗi Lesson Detail bị lỗi (Bị thiếu 1/5-6 scenario)  <br>  <br>=COUNTIF(A:A, B2) > 0 | Số Situations bị lỗi  <br>---  <br>"status": "error" |
| code retry audio                                                    |                                                                                                     |                                                      |

=> Code phần retry



---

# VỀ BÀI SEARCH: 

1. Check phần Dify trả về xem có hướng nào để cập nhất tốt hơn việc search ko, vấn đề hiện tại của việc search là gì ? 
2. Check phần giới hạn của API? 
3. xem có cần 1 hệ thống search mượt mà hơn ở đoạn đầu không? 

---
Giao việc là khi => Giao bớt đi, để có thời gian làm các việc khó và quan trọng hơn, ko phải là chơi



CHỦ ĐỘNG XEM CÁC PHẦN VÀ ĐỀ XUẤT GIẢI PHÁP TRƯỚC, KO ĐỢI ĐƯỢC ASSIGN. 

---
