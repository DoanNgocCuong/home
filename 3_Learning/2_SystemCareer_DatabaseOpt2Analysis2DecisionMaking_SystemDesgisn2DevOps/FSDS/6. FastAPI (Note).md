0.0.0.0 ~ 127.0.0.1 ~ localhost
```
TrÆ°á»›c Ä‘i thá»±c táº­p 6 thÃ¡ng toÃ n Flask, ko biáº¿t FastAPI luÃ´n. MÃ£i sau cÃ³ Ä‘á»©a báº¡n báº£o sao ko dÃ¹ng FastAPI má»›i biáº¿t
```

```python
from fastapi import FastAPI

app = FastAPI()

# HÃ m Ä‘Æ¡n giáº£n Ä‘á»ƒ tráº£ vá» má»™t thÃ´ng Ä‘iá»‡p
@app.get("/greet")
def greet():
    return {"message": "Hello, welcome to FastAPI!"}
    
@app.get("/items")
def get_items():
    return {"items": ["item1", "item2", "item3"]}
    
@app.post("/create_item")
def create_item(item: dict):
    return {"message": "Item created", "item": item}
```

### Tá»•ng káº¿t vá» cÃ¡c HTTP methods:

- **GET**: Láº¥y thÃ´ng tin tá»« server.
    
- **POST**: Gá»­i dá»¯ liá»‡u Ä‘á»ƒ táº¡o má»›i resource.
    
- **PUT**: Cáº­p nháº­t toÃ n bá»™ resource.
    
- **PATCH**: Cáº­p nháº­t má»™t pháº§n cá»§a resource.
    
- **DELETE**: XÃ³a resource.
    
- **OPTIONS**: Xem cÃ¡c phÆ°Æ¡ng thá»©c HTTP mÃ  server há»— trá»£.
    
- **HEAD**: Láº¥y thÃ´ng tin header mÃ  khÃ´ng cÃ³ thÃ¢n dá»¯ liá»‡u.
    

Má»—i phÆ°Æ¡ng thá»©c nÃ y Ä‘Æ°á»£c xá»­ lÃ½ báº±ng cÃ¡c decorator nhÆ° `@app.get()`, `@app.post()`, `@app.put()`, v.v.


---
- API Ä‘i tá»« trÃªn xuá»‘ng dÆ°á»›i, báº¯t Ä‘Ãºng tháº±ng cá»§a nÃ³ 
example 

- unitest lÃ  hÃ m test ko dÃ¹ng bÃªn thá»© 3, database, ,... 
![[Pasted image 20250418203421.png]]
![[Pasted image 20250418204251.png]]

```
response time, má»©c Ä‘á»™ chá»‹u táº£i (bao nhiÃªu user call tá»›i 1 lÃºc) , ... áº¡
```

```
- CÃ¡c yáº¿u tá»‘ nÃ o áº£nh hÆ°á»Ÿng Ä‘áº¿n sá»©c chá»‹u táº£i cá»§a 1 FastAPI áº¡.  
    
- ThÃ´ng thÆ°á»ng lÃ  bao nhiÃªu áº¡.  
    
- NgÃ´n ngá»¯ code cÃ³ áº£nh hÆ°á»Ÿng nhÆ° tháº¿ nÃ o Ä‘áº¿n response time vÃ  Ä‘á»™ chá»‹u táº£i áº¡.  
    

(cháº³ng háº¡n java script, python) áº¡.
```

Load test : What is the upper limit? Bao nhiÃªu ngÆ°á»i vÃ o cÃ¹ng lÃºc ? 
Stress test : How the system reacts under unexpected load?

```
- CÃ¡c yáº¿u tá»‘ nÃ o áº£nh hÆ°á»Ÿng Ä‘áº¿n sá»©c chá»‹u táº£i cá»§a 1 FastAPI áº¡.  
    +, resource 
    +, coding: 
- ThÃ´ng thÆ°á»ng stress test lÃ  bao nhiÃªu áº¡.  
    
- NgÃ´n ngá»¯ code cÃ³ áº£nh hÆ°á»Ÿng nhÆ° tháº¿ nÃ o Ä‘áº¿n response time vÃ  Ä‘á»™ chá»‹u táº£i áº¡.  
    => CÃ³, python ko nhanh báº±ng ngÃ´n ngá»¯ khÃ¡c 

(cháº³ng háº¡n java script, python) áº¡.
```

```
Cáº¥u hÃ¬nh vá» workers, sá»‘ lÆ°á»£ng threads vÃ  cÃ¡c tham sá»‘ khÃ¡c áº£nh hÆ°á»Ÿng lá»›n Ä‘áº¿n hiá»‡u suáº¥t. CPU, RAM, Bandwidth
```

- K6, jimenter, locuts
```
ngoÃ i response time thÃ¬ cÃ²n measure nÃ o khÃ¡c hay Ä‘Æ°á»£c dÃ¹ng k sÃ­p?
=> Concurrent users, Error rate, Latency percentiles cháº¯c v Ã¡ báº¡n
```
- RPS: request/second 
![[Pasted image 20250418205754.png]]

```
1000 thá»i Ä‘iá»ƒm 

1000 user => thÃ¬ response time váº«n bÃ¬nh thÆ°á»ng.  
1500 user vÃ o cÃ¹ng lÃºc thÃ¬ 1000 user Ä‘Æ°á»£c cháº¡y cÃ¹ng lÃºc, 500 user lÃºc Ä‘Ã³ pháº£i Ä‘á»£i => nÃªn lÃ  response time cá»§a 500 user nÃ y sáº½ bá»‹ tÄƒng Ä‘Ãºng ko áº¡. ğŸ˜

=> Äá»©c Huy Tráº§n: @CÆ°á»ng ÄoÃ n Ngá»c náº¿u cÃ³ chÆ¡i lol Ä‘Ã£ tá»«ng tháº¥y cÃ³ thá»i Ä‘iá»ƒm pháº£i Ä‘á»£i tÃ¬m tráº­n tá»›i máº¥y chá»¥c phÃºt =))))
```

[JMeter vs. Locust vs. k6 Comparison](https://sourceforge.net/software/compare/JMeter-vs-Locust-vs-k6/)


![[Pasted image 20250418210223.png]]
1. Giáº£m data size 
2. Auto services: khi mÃ  sá»‘ lÆ°á»£ng vÃ o tá»± táº¡o thÃªm mÃ¡y, tá»± scales 
3. Caching: K8s: 
	- Sá»­ dá»¥ng Cache trong FastAPI vá»›i Python's `functools.lru_cache`
	- Redis cho Caching
=> Log láº¡i. Decorator Ä‘á»ƒ log? (input, output, response time)

---
Sercurity FastAPI 

https://fastapi.tiangolo.com/tutorial/security/#openapi

![[Pasted image 20250418212851.png]]


![[Pasted image 20250418212903.png]]


---
# FastAPI : 

21/05/2025 

> Trong quÃ¡ trÃ¬nh nghe giáº£ng, em cÃ³ note láº¡i Ä‘Æ°á»£c khoáº£ng 50% lá»i chá»‰ dáº¡y cá»§a sáº¿p NguyÃªn vÃ  note láº¡i. Mong mn Ä‘á»c Ä‘Æ°á»£c nhiá»u Ä‘iá»u cáº§n thiáº¿t vÃ  nhá» cÃ¡c sáº¿p, cÃ¡c ace bá»• sung thÃªm cho dÃ i hÆ¡n áº¡ :v Thank everyon so much!

> GÃ³c vui váº»: TrÆ°á»›c em Ä‘i thá»±c táº­p 6 thÃ¡ng toÃ n Flask, ko biáº¿t FastAPI luÃ´n. MÃ£i sau cÃ³ Ä‘á»©a báº¡n báº£o sao ko dÃ¹ng FastAPI em má»›i chuyá»ƒn sang thá»­. vÃ  ui, FastAPI cÃ³ /docs Ä‘á»ƒ xem ngay cÃ¡c API Ä‘Æ°á»£c define bÃªn trong lÃ  gÃ¬!!!

`
## 1. ThÆ°á»ng dÃ¹ng nháº¥t lÃ : GET vÃ  POST 
```
from fastapi import FastAPI

app = FastAPI()

# HÃ m Ä‘Æ¡n giáº£n Ä‘á»ƒ tráº£ vá» má»™t thÃ´ng Ä‘iá»‡p
@app.get("/greet")
def greet():
    return {"message": "Hello, welcome to FastAPI!"}
    
@app.get("/items")
def get_items():
    return {"items": ["item1", "item2", "item3"]}
    
@app.post("/create_item")
def create_item(item: dict):
    return {"message": "Item created", "item": item}
```

CÃ¡c HTTP methods khÃ¡c nhÆ°:

- **GET**: Láº¥y thÃ´ng tin tá»« server.
- **POST**: Gá»­i dá»¯ liá»‡u Ä‘á»ƒ táº¡o má»›i resource.
- **PUT**: Cáº­p nháº­t toÃ n bá»™ resource.
- **PATCH**: Cáº­p nháº­t má»™t pháº§n cá»§a resource.
- **DELETE**: XÃ³a resource.
- **OPTIONS**: Xem cÃ¡c phÆ°Æ¡ng thá»©c HTTP mÃ  server há»— trá»£.
- **HEAD**: Láº¥y thÃ´ng tin header mÃ  khÃ´ng cÃ³ thÃ¢n dá»¯ liá»‡u.

## 2. The Testing Pyramid: The Key to Efficient Software Engineering 
1. Unit tests: individual components or functions. 
do not involve third-party services like databases.
2. Integration tests: how different modules or services work together.
3. Eng-to-end tests
## 3. Sá»©c chá»‹u táº£i

### 3.1 KhÃ¡i niá»‡m 
Load test : What is the upper limit? Bao nhiÃªu ngÆ°á»i vÃ o cÃ¹ng lÃºc ? 
Stress test : How the system reacts under unexpected load?

áº¢nh cho tháº¥y: 
- API hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng khi cÃ³ 1000 user Ä‘á»“ng thá»i
- API cÃ³ Ä‘á»™ trá»… khi cÃ³ 1500 user Ä‘á»“ng thá»i (1000 user bÃ¬nh thÆ°á»ng, 500 user pháº£i Ä‘á»£i)
- API gÃ£y khi 2000 user Ä‘á»“ng thá»i. 

### 3.2 CÃ¡c yáº¿u tá»‘ nÃ o áº£nh hÆ°á»Ÿng Ä‘áº¿n sá»©c chá»‹u táº£i cá»§a 1 FastAPI áº¡.  
Gá»“m 2 yáº¿u tá»‘: 
1. LÃ  resource: CPU, RAM, BÄƒng thÃ´ng máº¡ng, ... 
2. LÃ  coding: Thiáº¿t káº¿ kiáº¿n trÃºc tá»‘i Æ°u, quáº£n lÃ½ káº¿t ná»‘i, xá»­ lÃ½ báº¥t Ä‘á»“ng bá»™, ...

### 3.3 LÃ m sao Ä‘á»ƒ Ä‘o lÆ°á»ng sá»©c chá»‹u táº£i 

- Tool Ä‘á»ƒ Ä‘o sá»©c chá»‹u táº£i: [JMeter vs. Locust vs. k6 Comparison](https://sourceforge.net/software/compare/JMeter-vs-Locust-vs-k6/)

### 3.4 Improve API Performance: 
- Auto services: khi mÃ  sá»‘ lÆ°á»£ng vÃ o tá»± táº¡o thÃªm mÃ¡y, tá»± scales (K8s, ...)
- Caching: 
	- Sá»­ dá»¥ng Cache trong FastAPI vá»›i Python's `functools.lru_cache`
	- Redis cho Caching
## 4. Sercurity FastAPI 

https://fastapi.tiangolo.com/tutorial/security/#openapi



---
Viáº¿t bÃ i: https://www.linkedin.com/posts/doan-ngoc-cuong_doanngoccuong-fullstackdatascience-wecommit100x-activity-7320136100667146241-hGIl?utm_source=social_share_send&utm_medium=member_desktop_web&rcm=ACoAAC3wojwBYfkOk3q0b6y8Z_UF_N5ELvjQYVI

Link: [FAST API - B6 | FSDS](https://fullstackdatascience.com/courses/k6-mlops-1-gc5a2p/topic/119)


---

# GÃ³c há»i Ä‘Ã¡p: 

```
[Em há»i vá» MONITORING API].  
  
a KhiÃªm Æ¡i, bÃ i App The Coach Má»›i.  
Em deploy háº¿t API lÃªn rá»“i.  
----  
1. LÃ : Giá» lÃªn Production thÃ¬ trÆ°á»›c mn xÃ i gÃ¬ Ä‘á»ƒ MONITORING API tháº¿ áº¡. Em cÃ³ cáº§n tá»± triá»ƒn khai khÃ´ng hay lÃ  khi giao API cho bÃªn Backend. Chá»— Backend cÃ³ tool MONITORING API chung rá»“i áº¡.  
2. LÃ  náº¿u em tá»± triá»ƒn khai thÃ¬ anh cÃ³ gá»£i Ã½ tool nÃ o monitoring ko áº¡.  
  
Em cáº£m Æ¡n anh
```

```
1. anh hay dÃ¹ng locust =)) k6 hay dÃ¹ng cho go, jmeter java
    
2. _[_2:42 PM_]_
    
    cÆ¡ mÃ 
    
3. _[_2:42 PM_]_
    
    máº¥y tool kia Ä‘á»ƒ load/stress test mÃ  nhá»‰
    
4. _[_2:42 PM_]_
    
    monitor thÃ¬ cÃ³ nhiá»u thá»© láº¯m, xoanh quanh 3 cÃ¡i chÃ­nh lÃ  logs, metrics vÃ  traces nha
    
    ![pepecringe](https://cdn.discordapp.com/emojis/1247827442736037888.webp?size=56)
    
    1
    
5. ![](https://cdn.discordapp.com/avatars/601095875925901312/bda79e313bbb8b995822abb139de7fc3.webp?size=100)
    
    ### adrien_long _â€”_ 2:43 PM
    
    Láº¡i bá»• sung thÃªm vÃ o code ná»¯a Ã 
    
6. _[_2:43 PM_]_
    
    ![:pepecringe:](https://cdn.discordapp.com/emojis/1247827442736037888.webp?size=128)
    
7. ![](https://cdn.discordapp.com/avatars/827755428728930364/39234351505e1c7b1c8e9dbf8752d4a9.webp?size=100)
    
    ### quandv _â€”_ 2:43 PM
    
    Ä‘Ãºng Ã²i, sáº½ há»c á»Ÿ bÃ i observable system sáº¿p nhÃ©
    
    ![pepepray](https://cdn.discordapp.com/emojis/1244838094457274398.webp?size=56)
    
    2
    
8. ![](https://cdn.discordapp.com/avatars/601095875925901312/bda79e313bbb8b995822abb139de7fc3.webp?size=100)
    
    ### adrien_long _â€”_ 2:45 PM
    
    Cá»© hnao code hÃ²m hÃ²m xong rá»“i lÃªn group Ä‘á»c láº¡i lÃºi hÃºi sá»­a
    
    ![ğŸ¥²](https://discord.com/assets/69aa309e02aeb2c4.svg)
    
    1
    
9. ![](https://cdn.discordapp.com/avatars/827755428728930364/39234351505e1c7b1c8e9dbf8752d4a9.webp?size=20)@quandv
    
    monitor thÃ¬ cÃ³ nhiá»u thá»© láº¯m, xoanh quanh 3 cÃ¡i chÃ­nh lÃ  logs, metrics vÃ  traces nha
    
    ![](https://cdn.discordapp.com/avatars/887982602856845312/368740c13e5cbfaf3a1236c10f2ecc30.webp?size=100)
    
    ### ÄoÃ n Ngá»c CÆ°á»ng - AI _â€”_ 2:47 PM
    
    sáº¿p QuÃ¢n gá»£i Ã½ framework nÃ o MONITORING API ko áº¡. ![:pepepray~1:](https://cdn.discordapp.com/emojis/1244838094457274398.webp?size=56)
    
10. _[_2:47 PM_]_
    
    gáº¥p sáº¿p áº¡ ![:stronge:](https://cdn.discordapp.com/emojis/1247827449551523862.webp?size=56)
    
11. ![](https://cdn.discordapp.com/avatars/827755428728930364/39234351505e1c7b1c8e9dbf8752d4a9.webp?size=100)
    
    ### quandv _â€”_ 2:48 PM
    
    opentelemetry + prometheus&grafana (metrics) + elk (logs) + jaeger (traces)
    
    ![partyhatsmiwe](https://cdn.discordapp.com/emojis/1247827444770279445.webp?size=56)
    
    1
    
    ![â¤ï¸](https://discord.com/assets/8838f014a5d2ce59.svg)
    
    1
    
12. ![](https://cdn.discordapp.com/avatars/887982602856845312/368740c13e5cbfaf3a1236c10f2ecc30.webp?size=100)
    
    ### ÄoÃ n Ngá»c CÆ°á»ng - AI _â€”_ 2:50 PM
    
    Äá»™i Æ¡n anh, Ä‘á»ƒ em search ![ğŸ˜„](https://discord.com/assets/58a76b2430663605.svg)
    

new

14. ![](https://cdn.discordapp.com/avatars/827755428728930364/39234351505e1c7b1c8e9dbf8752d4a9.webp?size=100)
    
    ### quandv _â€”_ 2:51 PM
    
    k dÃ¡m
    

Message #k6-mlops-1
```

```
anh hay dÃ¹ng locust =)) k6 hay dÃ¹ng cho go, jmeter java
opentelemetry + prometheus&grafana (metrics) + elk (logs) + jaeger (traces)
```

## opentelemetry + prometheus&grafana (metrics) + elk (logs) + jaeger (traces)

### 3.1 - Cáº§n giÃ¡m sÃ¡t nhá»¯ng cÃ¡i gÃ¬? (metrics, logs, traces), lÃ  gÃ¬? bá» Ä‘i cÃ¡i nÃ o Ä‘Æ°á»£c ko, cÃ²n thiáº¿u cÃ¡i nÃ o ko Khi nÃ o thÃ¬ cáº§n cÃ¡i nÃ o?


 3 loáº¡i dá»¯ liá»‡u quan sÃ¡t (Observability pillars)

| Loáº¡i      | Gá»i lÃ    | Má»¥c Ä‘Ã­ch chÃ­nh                                    | VÃ­ dá»¥ thá»±c táº¿                                                  |
| --------- | -------- | ------------------------------------------------- | -------------------------------------------------------------- |
| âœ… Metrics | Äo Ä‘áº¡c   | Theo dÃµi cÃ¡c chá»‰ sá»‘ sá»‘ há»c (sá»©c khá»e há»‡ thá»‘ng)    | CPU %, Memory %, Request/s, Error rate                         |
| âœ… Logs    | Ghi láº¡i  | Ghi láº¡i sá»± kiá»‡n chi tiáº¿t, lá»—i, thÃ´ng tin há»‡ thá»‘ng | â€œUser X logged inâ€, â€œError at line 25: timeoutâ€                |
| âœ… Traces  | Theo váº¿t | Theo dÃµi luá»“ng request Ä‘i qua cÃ¡c service/API     | Request A máº¥t 150ms, Ä‘i qua 3 middleware, cháº­m á»Ÿ DB call 100ms |

---

## ğŸ“¦ 2. Khi nÃ o cáº§n loáº¡i nÃ o?

### âœ… **Metrics â€“ LUÃ”N NÃŠN DÃ™NG**

- ÄÆ¡n giáº£n, nháº¹, khÃ´ng tá»‘n tÃ i nguyÃªn.
    
- Äá»§ Ä‘á»ƒ alert: cÃ³ nhiá»u request lá»—i khÃ´ng? CPU cao khÃ´ng?
    
- PhÃ¹ há»£p cho dashboard vÃ  Prometheus/Grafana.
    

> **DÃ¹ng Ä‘á»ƒ Ä‘o lÆ°á»ng _tÃ¬nh tráº¡ng chung_ cá»§a há»‡ thá»‘ng.**

---

### âœ… **Logs â€“ NÃŠN CÃ“ KHI DEBUG HOáº¶C PHÃ‚N TÃCH Váº¤N Äá»€**

- DÃ¹ng Ä‘á»ƒ kiá»ƒm tra hÃ nh vi cá»¥ thá»ƒ: cÃ³ lá»—i gÃ¬ xáº£y ra? ná»™i dung lá»—i lÃ  gÃ¬?
    
- Cáº§n thiáº¿t khi troubleshoot lá»—i, security.
    

> **DÃ¹ng Ä‘á»ƒ hiá»ƒu _chuyá»‡n gÃ¬ Ä‘ang xáº£y ra cá»¥ thá»ƒ_, giÃºp fix bug.**

---

### âœ… **Traces â€“ Cáº¦N KHI CÃ“ NHIá»€U SERVICE hoáº·c API CHUá»–I**

- DÃ¹ng Ä‘á»ƒ hiá»ƒu â€œrequest Ä‘i Ä‘Ã¢u, cháº­m á»Ÿ Ä‘Ã¢uâ€.
    
- DÃ¹ng Jaeger Ä‘á»ƒ visualize tá»«ng bÆ°á»›c Ä‘i cá»§a request.
    

> **DÃ¹ng Ä‘á»ƒ hiá»ƒu rÃµ _luá»“ng xá»­ lÃ½_ vÃ  tÃ¬m _nÃºt cá»• chai_ hiá»‡u nÄƒng.**

---

## âŒ CÃ³ thá»ƒ bá» cÃ¡i nÃ o?

| Náº¿u báº¡n chá»‰ cÃ³ 1 API nhá»             | CÃ³ thá»ƒ **bá» trace**, chá»‰ dÃ¹ng **metrics + logs**               |
| ------------------------------------ | -------------------------------------------------------------- |
| Náº¿u báº¡n cáº§n debug nÃ¢ng cao           | Giá»¯ **logs**, cÃ³ thá»ƒ táº¡m bá» **metrics** náº¿u chÆ°a cáº§n dashboard |
| Náº¿u báº¡n cáº§n hiá»‡u nÄƒng vÃ  Ä‘á»™ trá»… tháº¥p | Giá»¯ **traces** Ä‘á»ƒ tÃ¬m bottleneck                               |

**KhÃ´ng nÃªn bá» cáº£ 3**. Tá»‘i thiá»ƒu: **nÃªn cÃ³ metrics hoáº·c logs.**

---

## ğŸ” CÃ³ thiáº¿u cÃ¡i gÃ¬ khÃ´ng?

CÆ¡ báº£n **3 cÃ¡i nÃ y lÃ  Ä‘á»§** cho má»i há»‡ thá»‘ng:

- Metrics (Prometheus)
    
- Logs (ELK)
    
- Traces (Jaeger)
    

**TÃ¹y má»Ÿ rá»™ng thÃªm:**

| TÃ­nh nÄƒng thÃªm              | CÃ´ng cá»¥                   | Khi nÃ o cáº§n?                        |
| --------------------------- | ------------------------- | ----------------------------------- |
| Alert (cáº£nh bÃ¡o)            | Prometheus + Alertmanager | Muá»‘n cáº£nh bÃ¡o khi lá»—i vÆ°á»£t ngÆ°á»¡ng   |
| Monitoring uptime           | UptimeRobot, Grafana      | Cáº£nh bÃ¡o khi API down               |
| APM (Application Perf Mgmt) | Datadog / NewRelic        | Khi cáº§n giáº£i phÃ¡p thÆ°Æ¡ng máº¡i Ä‘áº§y Ä‘á»§ |

---

## âœ… Tá»•ng káº¿t gá»£i Ã½ triá»ƒn khai Ä‘Æ¡n giáº£n cho báº¡n

- **Ãt service (mono hoáº·c vÃ i API)**: DÃ¹ng Metrics + Logs, báº­t Trace náº¿u debug
    
- **TrÃªn production**: NÃªn cÃ³ cáº£ 3 (Metrics Ä‘á»ƒ alert, Logs Ä‘á»ƒ phÃ¢n tÃ­ch, Traces Ä‘á»ƒ hiá»ƒu dÃ²ng cháº£y)
    
- **Æ¯u tiÃªn**:
    
    1. Metrics â†’ Ä‘á»ƒ biáº¿t "cÃ³ váº¥n Ä‘á»"
        
    2. Logs â†’ Ä‘á»ƒ biáº¿t "váº¥n Ä‘á» gÃ¬"
        
    3. Traces â†’ Ä‘á»ƒ biáº¿t "váº¥n Ä‘á» á»Ÿ Ä‘Ã¢u trong flow"
        

---

### 3.2 