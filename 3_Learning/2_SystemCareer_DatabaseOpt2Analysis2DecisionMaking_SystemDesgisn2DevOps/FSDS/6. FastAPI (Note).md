0.0.0.0 ~ 127.0.0.1 ~ localhost
```
Tr∆∞·ªõc ƒëi th·ª±c t·∫≠p 6 th√°ng to√†n Flask, ko bi·∫øt FastAPI lu√¥n. M√£i sau c√≥ ƒë·ª©a b·∫°n b·∫£o sao ko d√πng FastAPI m·ªõi bi·∫øt
```

```python
from fastapi import FastAPI

app = FastAPI()

# H√†m ƒë∆°n gi·∫£n ƒë·ªÉ tr·∫£ v·ªÅ m·ªôt th√¥ng ƒëi·ªáp
@app.get("/greet")
def greet():
    return {"message": "Hello, welcome to FastAPI!"}
    
@app.get("/items")
def get_items():
    return {"items": ["item1", "item2", "item3"]}
    
@app.post("/create_item")
def create_item(item: dict):
    return {"message": "Item created", "item": item}
```

### T·ªïng k·∫øt v·ªÅ c√°c HTTP methods:

- **GET**: L·∫•y th√¥ng tin t·ª´ server.
    
- **POST**: G·ª≠i d·ªØ li·ªáu ƒë·ªÉ t·∫°o m·ªõi resource.
    
- **PUT**: C·∫≠p nh·∫≠t to√†n b·ªô resource.
    
- **PATCH**: C·∫≠p nh·∫≠t m·ªôt ph·∫ßn c·ªßa resource.
    
- **DELETE**: X√≥a resource.
    
- **OPTIONS**: Xem c√°c ph∆∞∆°ng th·ª©c HTTP m√† server h·ªó tr·ª£.
    
- **HEAD**: L·∫•y th√¥ng tin header m√† kh√¥ng c√≥ th√¢n d·ªØ li·ªáu.
    

M·ªói ph∆∞∆°ng th·ª©c n√†y ƒë∆∞·ª£c x·ª≠ l√Ω b·∫±ng c√°c decorator nh∆∞ `@app.get()`, `@app.post()`, `@app.put()`, v.v.


---
- API ƒëi t·ª´ tr√™n xu·ªëng d∆∞·ªõi, b·∫Øt ƒë√∫ng th·∫±ng c·ªßa n√≥ 
example 

- unitest l√† h√†m test ko d√πng b√™n th·ª© 3, database, ,... 
![[Pasted image 20250418203421.png]]
![[Pasted image 20250418204251.png]]

```
response time, m·ª©c ƒë·ªô ch·ªãu t·∫£i (bao nhi√™u user call t·ªõi 1 l√∫c) , ... ·∫°
```

```
- C√°c y·∫øu t·ªë n√†o ·∫£nh h∆∞·ªüng ƒë·∫øn s·ª©c ch·ªãu t·∫£i c·ªßa 1 FastAPI ·∫°.  
    
- Th√¥ng th∆∞·ªùng l√† bao nhi√™u ·∫°.  
    
- Ng√¥n ng·ªØ code c√≥ ·∫£nh h∆∞·ªüng nh∆∞ th·∫ø n√†o ƒë·∫øn response time v√† ƒë·ªô ch·ªãu t·∫£i ·∫°.  
    

(ch·∫≥ng h·∫°n java script, python) ·∫°.
```

Load test : What is the upper limit? Bao nhi√™u ng∆∞·ªùi v√†o c√πng l√∫c ? 
Stress test : How the system reacts under unexpected load?

```
- C√°c y·∫øu t·ªë n√†o ·∫£nh h∆∞·ªüng ƒë·∫øn s·ª©c ch·ªãu t·∫£i c·ªßa 1 FastAPI ·∫°.  
    +, resource 
    +, coding: 
- Th√¥ng th∆∞·ªùng stress test l√† bao nhi√™u ·∫°.  
    
- Ng√¥n ng·ªØ code c√≥ ·∫£nh h∆∞·ªüng nh∆∞ th·∫ø n√†o ƒë·∫øn response time v√† ƒë·ªô ch·ªãu t·∫£i ·∫°.  
    => C√≥, python ko nhanh b·∫±ng ng√¥n ng·ªØ kh√°c 

(ch·∫≥ng h·∫°n java script, python) ·∫°.
```

```
C·∫•u h√¨nh v·ªÅ workers, s·ªë l∆∞·ª£ng threads v√† c√°c tham s·ªë kh√°c ·∫£nh h∆∞·ªüng l·ªõn ƒë·∫øn hi·ªáu su·∫•t. CPU, RAM, Bandwidth
```

- K6, jimenter, locuts
```
ngo√†i response time th√¨ c√≤n measure n√†o kh√°c hay ƒë∆∞·ª£c d√πng k s√≠p?
=> Concurrent users, Error rate, Latency percentiles ch·∫Øc v √° b·∫°n
```
- RPS: request/second 
![[Pasted image 20250418205754.png]]

```
1000 th·ªùi ƒëi·ªÉm 

1000 user => th√¨ response time v·∫´n b√¨nh th∆∞·ªùng.  
1500 user v√†o c√πng l√∫c th√¨ 1000 user ƒë∆∞·ª£c ch·∫°y c√πng l√∫c, 500 user l√∫c ƒë√≥ ph·∫£i ƒë·ª£i => n√™n l√† response time c·ªßa 500 user n√†y s·∫Ω b·ªã tƒÉng ƒë√∫ng ko ·∫°. üòÅ

=> ƒê·ª©c Huy Tr·∫ßn: @C∆∞·ªùng ƒêo√†n Ng·ªçc n·∫øu c√≥ ch∆°i lol ƒë√£ t·ª´ng th·∫•y c√≥ th·ªùi ƒëi·ªÉm ph·∫£i ƒë·ª£i t√¨m tr·∫≠n t·ªõi m·∫•y ch·ª•c ph√∫t =))))
```

[JMeter vs. Locust vs. k6 Comparison](https://sourceforge.net/software/compare/JMeter-vs-Locust-vs-k6/)


![[Pasted image 20250418210223.png]]
1. Gi·∫£m data size 
2. Auto services: khi m√† s·ªë l∆∞·ª£ng v√†o t·ª± t·∫°o th√™m m√°y, t·ª± scales 
3. Caching: K8s: 
	- S·ª≠ d·ª•ng Cache trong FastAPI v·ªõi Python's `functools.lru_cache`
	- Redis cho Caching
=> Log l·∫°i. Decorator ƒë·ªÉ log? (input, output, response time)

---
Sercurity FastAPI 

https://fastapi.tiangolo.com/tutorial/security/#openapi

![[Pasted image 20250418212851.png]]


![[Pasted image 20250418212903.png]]


---
# FastAPI : 

21/05/2025 

> Trong qu√° tr√¨nh nghe gi·∫£ng, em c√≥ note l·∫°i ƒë∆∞·ª£c kho·∫£ng 50% l·ªùi ch·ªâ d·∫°y c·ªßa s·∫øp Nguy√™n v√† note l·∫°i. Mong mn ƒë·ªçc ƒë∆∞·ª£c nhi·ªÅu ƒëi·ªÅu c·∫ßn thi·∫øt v√† nh·ªù c√°c s·∫øp, c√°c ace b·ªï sung th√™m cho d√†i h∆°n ·∫° :v Thank everyon so much!

> G√≥c vui v·∫ª: Tr∆∞·ªõc em ƒëi th·ª±c t·∫≠p 6 th√°ng to√†n Flask, ko bi·∫øt FastAPI lu√¥n. M√£i sau c√≥ ƒë·ª©a b·∫°n b·∫£o sao ko d√πng FastAPI em m·ªõi chuy·ªÉn sang th·ª≠. v√† ui, FastAPI c√≥ /docs ƒë·ªÉ xem ngay c√°c API ƒë∆∞·ª£c define b√™n trong l√† g√¨!!!

`
## 1. Th∆∞·ªùng d√πng nh·∫•t l√†: GET v√† POST 
```
from fastapi import FastAPI

app = FastAPI()

# H√†m ƒë∆°n gi·∫£n ƒë·ªÉ tr·∫£ v·ªÅ m·ªôt th√¥ng ƒëi·ªáp
@app.get("/greet")
def greet():
    return {"message": "Hello, welcome to FastAPI!"}
    
@app.get("/items")
def get_items():
    return {"items": ["item1", "item2", "item3"]}
    
@app.post("/create_item")
def create_item(item: dict):
    return {"message": "Item created", "item": item}
```

C√°c HTTP methods kh√°c nh∆∞:

- **GET**: L·∫•y th√¥ng tin t·ª´ server.
- **POST**: G·ª≠i d·ªØ li·ªáu ƒë·ªÉ t·∫°o m·ªõi resource.
- **PUT**: C·∫≠p nh·∫≠t to√†n b·ªô resource.
- **PATCH**: C·∫≠p nh·∫≠t m·ªôt ph·∫ßn c·ªßa resource.
- **DELETE**: X√≥a resource.
- **OPTIONS**: Xem c√°c ph∆∞∆°ng th·ª©c HTTP m√† server h·ªó tr·ª£.
- **HEAD**: L·∫•y th√¥ng tin header m√† kh√¥ng c√≥ th√¢n d·ªØ li·ªáu.

## 2. The Testing Pyramid: The Key to Efficient Software Engineering 
1. Unit tests: individual components or functions. 
do not involve third-party services like databases.
2. Integration tests: how different modules or services work together.
3. Eng-to-end tests
## 3. S·ª©c ch·ªãu t·∫£i

### 3.1 Kh√°i ni·ªám 
Load test : What is the upper limit? Bao nhi√™u ng∆∞·ªùi v√†o c√πng l√∫c ? 
Stress test : How the system reacts under unexpected load?

·∫¢nh cho th·∫•y: 
- API ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng khi c√≥ 1000 user ƒë·ªìng th·ªùi
- API c√≥ ƒë·ªô tr·ªÖ khi c√≥ 1500 user ƒë·ªìng th·ªùi (1000 user b√¨nh th∆∞·ªùng, 500 user ph·∫£i ƒë·ª£i)
- API g√£y khi 2000 user ƒë·ªìng th·ªùi. 

### 3.2 C√°c y·∫øu t·ªë n√†o ·∫£nh h∆∞·ªüng ƒë·∫øn s·ª©c ch·ªãu t·∫£i c·ªßa 1 FastAPI ·∫°.  
G·ªìm 2 y·∫øu t·ªë: 
1. L√† resource: CPU, RAM, BƒÉng th√¥ng m·∫°ng, ... 
2. L√† coding: Thi·∫øt k·∫ø ki·∫øn tr√∫c t·ªëi ∆∞u, qu·∫£n l√Ω k·∫øt n·ªëi, x·ª≠ l√Ω b·∫•t ƒë·ªìng b·ªô, ...

### 3.3 L√†m sao ƒë·ªÉ ƒëo l∆∞·ªùng s·ª©c ch·ªãu t·∫£i 

- Tool ƒë·ªÉ ƒëo s·ª©c ch·ªãu t·∫£i: [JMeter vs. Locust vs. k6 Comparison](https://sourceforge.net/software/compare/JMeter-vs-Locust-vs-k6/)

### 3.4 Improve API Performance: 
- Auto services: khi m√† s·ªë l∆∞·ª£ng v√†o t·ª± t·∫°o th√™m m√°y, t·ª± scales (K8s, ...)
- Caching: 
	- S·ª≠ d·ª•ng Cache trong FastAPI v·ªõi Python's `functools.lru_cache`
	- Redis cho Caching
## 4. Sercurity FastAPI 

https://fastapi.tiangolo.com/tutorial/security/#openapi



---
Vi·∫øt b√†i: https://www.linkedin.com/posts/doan-ngoc-cuong_doanngoccuong-fullstackdatascience-wecommit100x-activity-7320136100667146241-hGIl?utm_source=social_share_send&utm_medium=member_desktop_web&rcm=ACoAAC3wojwBYfkOk3q0b6y8Z_UF_N5ELvjQYVI

Link: [FAST API - B6 | FSDS](https://fullstackdatascience.com/courses/k6-mlops-1-gc5a2p/topic/119)


---

# G√≥c h·ªèi ƒë√°p: 

```
[Em h·ªèi v·ªÅ MONITORING API].  
  
a Khi√™m ∆°i, b√†i App The Coach M·ªõi.  
Em deploy h·∫øt API l√™n r·ªìi.  
----  
1. L√†: Gi·ªù l√™n Production th√¨ tr∆∞·ªõc mn x√†i g√¨ ƒë·ªÉ MONITORING API th·∫ø ·∫°. Em c√≥ c·∫ßn t·ª± tri·ªÉn khai kh√¥ng hay l√† khi giao API cho b√™n Backend. Ch·ªó Backend c√≥ tool MONITORING API chung r·ªìi ·∫°.  
2. L√† n·∫øu em t·ª± tri·ªÉn khai th√¨ anh c√≥ g·ª£i √Ω tool n√†o monitoring ko ·∫°.  
  
Em c·∫£m ∆°n anh
```

```
1. anh hay d√πng locust =)) k6 hay d√πng cho go, jmeter java
    
2. _[_2:42 PM_]_
    
    c∆° m√†
    
3. _[_2:42 PM_]_
    
    m·∫•y tool kia ƒë·ªÉ load/stress test m√† nh·ªâ
    
4. _[_2:42 PM_]_
    
    monitor th√¨ c√≥ nhi·ªÅu th·ª© l·∫Øm, xoanh quanh 3 c√°i ch√≠nh l√† logs, metrics v√† traces nha
    
    ![pepecringe](https://cdn.discordapp.com/emojis/1247827442736037888.webp?size=56)
    
    1
    
5. ![](https://cdn.discordapp.com/avatars/601095875925901312/bda79e313bbb8b995822abb139de7fc3.webp?size=100)
    
    ### adrien_long _‚Äî_ 2:43 PM
    
    L·∫°i b·ªï sung th√™m v√†o code n·ªØa √†
    
6. _[_2:43 PM_]_
    
    ![:pepecringe:](https://cdn.discordapp.com/emojis/1247827442736037888.webp?size=128)
    
7. ![](https://cdn.discordapp.com/avatars/827755428728930364/39234351505e1c7b1c8e9dbf8752d4a9.webp?size=100)
    
    ### quandv _‚Äî_ 2:43 PM
    
    ƒë√∫ng √≤i, s·∫Ω h·ªçc ·ªü b√†i observable system s·∫øp nh√©
    
    ![pepepray](https://cdn.discordapp.com/emojis/1244838094457274398.webp?size=56)
    
    2
    
8. ![](https://cdn.discordapp.com/avatars/601095875925901312/bda79e313bbb8b995822abb139de7fc3.webp?size=100)
    
    ### adrien_long _‚Äî_ 2:45 PM
    
    C·ª© hnao code h√≤m h√≤m xong r·ªìi l√™n group ƒë·ªçc l·∫°i l√∫i h√∫i s·ª≠a
    
    ![ü•≤](https://discord.com/assets/69aa309e02aeb2c4.svg)
    
    1
    
9. ![](https://cdn.discordapp.com/avatars/827755428728930364/39234351505e1c7b1c8e9dbf8752d4a9.webp?size=20)@quandv
    
    monitor th√¨ c√≥ nhi·ªÅu th·ª© l·∫Øm, xoanh quanh 3 c√°i ch√≠nh l√† logs, metrics v√† traces nha
    
    ![](https://cdn.discordapp.com/avatars/887982602856845312/368740c13e5cbfaf3a1236c10f2ecc30.webp?size=100)
    
    ### ƒêo√†n Ng·ªçc C∆∞·ªùng - AI _‚Äî_ 2:47 PM
    
    s·∫øp Qu√¢n g·ª£i √Ω framework n√†o MONITORING API ko ·∫°. ![:pepepray~1:](https://cdn.discordapp.com/emojis/1244838094457274398.webp?size=56)
    
10. _[_2:47 PM_]_
    
    g·∫•p s·∫øp ·∫° ![:stronge:](https://cdn.discordapp.com/emojis/1247827449551523862.webp?size=56)
    
11. ![](https://cdn.discordapp.com/avatars/827755428728930364/39234351505e1c7b1c8e9dbf8752d4a9.webp?size=100)
    
    ### quandv _‚Äî_ 2:48 PM
    
    opentelemetry + prometheus&grafana (metrics) + elk (logs) + jaeger (traces)
    
    ![partyhatsmiwe](https://cdn.discordapp.com/emojis/1247827444770279445.webp?size=56)
    
    1
    
    ![‚ù§Ô∏è](https://discord.com/assets/8838f014a5d2ce59.svg)
    
    1
    
12. ![](https://cdn.discordapp.com/avatars/887982602856845312/368740c13e5cbfaf3a1236c10f2ecc30.webp?size=100)
    
    ### ƒêo√†n Ng·ªçc C∆∞·ªùng - AI _‚Äî_ 2:50 PM
    
    ƒê·ªôi ∆°n anh, ƒë·ªÉ em search ![üòÑ](https://discord.com/assets/58a76b2430663605.svg)
    

new

14. ![](https://cdn.discordapp.com/avatars/827755428728930364/39234351505e1c7b1c8e9dbf8752d4a9.webp?size=100)
    
    ### quandv _‚Äî_ 2:51 PM
    
    k d√°m
    

Message #k6-mlops-1
```

```
anh hay d√πng locust =)) k6 hay d√πng cho go, jmeter java
opentelemetry + prometheus&grafana (metrics) + elk (logs) + jaeger (traces)
```

## opentelemetry + prometheus&grafana (metrics) + elk (logs) + jaeger (traces)

### 3.1 - C·∫ßn gi√°m s√°t nh·ªØng c√°i g√¨? (metrics, logs, traces), l√† g√¨? b·ªè ƒëi c√°i n√†o ƒë∆∞·ª£c ko, c√≤n thi·∫øu c√°i n√†o ko Khi n√†o th√¨ c·∫ßn c√°i n√†o?


 3 lo·∫°i d·ªØ li·ªáu quan s√°t (Observability pillars)

| Lo·∫°i      | G·ªçi l√†   | M·ª•c ƒë√≠ch ch√≠nh                                    | V√≠ d·ª• th·ª±c t·∫ø                                                  |
| --------- | -------- | ------------------------------------------------- | -------------------------------------------------------------- |
| ‚úÖ Metrics | ƒêo ƒë·∫°c   | Theo d√µi c√°c ch·ªâ s·ªë s·ªë h·ªçc (s·ª©c kh·ªèe h·ªá th·ªëng)    | CPU %, Memory %, Request/s, Error rate                         |
| ‚úÖ Logs    | Ghi l·∫°i  | Ghi l·∫°i s·ª± ki·ªán chi ti·∫øt, l·ªói, th√¥ng tin h·ªá th·ªëng | ‚ÄúUser X logged in‚Äù, ‚ÄúError at line 25: timeout‚Äù                |
| ‚úÖ Traces  | Theo v·∫øt | Theo d√µi lu·ªìng request ƒëi qua c√°c service/API     | Request A m·∫•t 150ms, ƒëi qua 3 middleware, ch·∫≠m ·ªü DB call 100ms |

---

## üì¶ 2. Khi n√†o c·∫ßn lo·∫°i n√†o?

### ‚úÖ **Metrics ‚Äì LU√îN N√äN D√ôNG**

- ƒê∆°n gi·∫£n, nh·∫π, kh√¥ng t·ªën t√†i nguy√™n.
    
- ƒê·ªß ƒë·ªÉ alert: c√≥ nhi·ªÅu request l·ªói kh√¥ng? CPU cao kh√¥ng?
    
- Ph√π h·ª£p cho dashboard v√† Prometheus/Grafana.
    

> **D√πng ƒë·ªÉ ƒëo l∆∞·ªùng _t√¨nh tr·∫°ng chung_ c·ªßa h·ªá th·ªëng.**

---

### ‚úÖ **Logs ‚Äì N√äN C√ì KHI DEBUG HO·∫∂C PH√ÇN T√çCH V·∫§N ƒê·ªÄ**

- D√πng ƒë·ªÉ ki·ªÉm tra h√†nh vi c·ª• th·ªÉ: c√≥ l·ªói g√¨ x·∫£y ra? n·ªôi dung l·ªói l√† g√¨?
    
- C·∫ßn thi·∫øt khi troubleshoot l·ªói, security.
    

> **D√πng ƒë·ªÉ hi·ªÉu _chuy·ªán g√¨ ƒëang x·∫£y ra c·ª• th·ªÉ_, gi√∫p fix bug.**

---

### ‚úÖ **Traces ‚Äì C·∫¶N KHI C√ì NHI·ªÄU SERVICE ho·∫∑c API CHU·ªñI**

- D√πng ƒë·ªÉ hi·ªÉu ‚Äúrequest ƒëi ƒë√¢u, ch·∫≠m ·ªü ƒë√¢u‚Äù.
    
- D√πng Jaeger ƒë·ªÉ visualize t·ª´ng b∆∞·ªõc ƒëi c·ªßa request.
    

> **D√πng ƒë·ªÉ hi·ªÉu r√µ _lu·ªìng x·ª≠ l√Ω_ v√† t√¨m _n√∫t c·ªï chai_ hi·ªáu nƒÉng.**

---

## ‚ùå C√≥ th·ªÉ b·ªè c√°i n√†o?

| N·∫øu b·∫°n ch·ªâ c√≥ 1 API nh·ªè             | C√≥ th·ªÉ **b·ªè trace**, ch·ªâ d√πng **metrics + logs**               |
| ------------------------------------ | -------------------------------------------------------------- |
| N·∫øu b·∫°n c·∫ßn debug n√¢ng cao           | Gi·ªØ **logs**, c√≥ th·ªÉ t·∫°m b·ªè **metrics** n·∫øu ch∆∞a c·∫ßn dashboard |
| N·∫øu b·∫°n c·∫ßn hi·ªáu nƒÉng v√† ƒë·ªô tr·ªÖ th·∫•p | Gi·ªØ **traces** ƒë·ªÉ t√¨m bottleneck                               |

**Kh√¥ng n√™n b·ªè c·∫£ 3**. T·ªëi thi·ªÉu: **n√™n c√≥ metrics ho·∫∑c logs.**

---

## üîç C√≥ thi·∫øu c√°i g√¨ kh√¥ng?

C∆° b·∫£n **3 c√°i n√†y l√† ƒë·ªß** cho m·ªçi h·ªá th·ªëng:

- Metrics (Prometheus)
    
- Logs (ELK)
    
- Traces (Jaeger)
    

**T√πy m·ªü r·ªông th√™m:**

| T√≠nh nƒÉng th√™m              | C√¥ng c·ª•                   | Khi n√†o c·∫ßn?                        |
| --------------------------- | ------------------------- | ----------------------------------- |
| Alert (c·∫£nh b√°o)            | Prometheus + Alertmanager | Mu·ªën c·∫£nh b√°o khi l·ªói v∆∞·ª£t ng∆∞·ª°ng   |
| Monitoring uptime           | UptimeRobot, Grafana      | C·∫£nh b√°o khi API down               |
| APM (Application Perf Mgmt) | Datadog / NewRelic        | Khi c·∫ßn gi·∫£i ph√°p th∆∞∆°ng m·∫°i ƒë·∫ßy ƒë·ªß |

---

## ‚úÖ T·ªïng k·∫øt g·ª£i √Ω tri·ªÉn khai ƒë∆°n gi·∫£n cho b·∫°n

- **√çt service (mono ho·∫∑c v√†i API)**: D√πng Metrics + Logs, b·∫≠t Trace n·∫øu debug
    
- **Tr√™n production**: N√™n c√≥ c·∫£ 3 (Metrics ƒë·ªÉ alert, Logs ƒë·ªÉ ph√¢n t√≠ch, Traces ƒë·ªÉ hi·ªÉu d√≤ng ch·∫£y)
    
- **∆Øu ti√™n**:
    
    1. Metrics ‚Üí ƒë·ªÉ bi·∫øt "c√≥ v·∫•n ƒë·ªÅ"
        
    2. Logs ‚Üí ƒë·ªÉ bi·∫øt "v·∫•n ƒë·ªÅ g√¨"
        
    3. Traces ‚Üí ƒë·ªÉ bi·∫øt "v·∫•n ƒë·ªÅ ·ªü ƒë√¢u trong flow"
        

---

### 3.2 