0.0.0.0 ~ 127.0.0.1 ~ localhost
```
TrÆ°á»›c Ä‘i thá»±c táº­p 6 thÃ¡ng toÃ n Flask, ko biáº¿t FastAPI luÃ´n. MÃ£i sau cÃ³ Ä‘á»©a báº¡n báº£o sao ko dÃ¹ng FastAPI má»›i biáº¿t
```

```python
from fastapi import FastAPI

app = FastAPI()

# HÃ m Ä‘Æ¡n giáº£n Ä‘á»ƒ tráº£ vá» má»™t thÃ´ng Ä‘iá»‡p
@app.get("/greet")
def greet():
    return {"message": "Hello, welcome to FastAPI!"}
    
@app.get("/items")
def get_items():
    return {"items": ["item1", "item2", "item3"]}
    
@app.post("/create_item")
def create_item(item: dict):
    return {"message": "Item created", "item": item}
```

### Tá»•ng káº¿t vá» cÃ¡c HTTP methods:

- **GET**: Láº¥y thÃ´ng tin tá»« server.
    
- **POST**: Gá»­i dá»¯ liá»‡u Ä‘á»ƒ táº¡o má»›i resource.
    
- **PUT**: Cáº­p nháº­t toÃ n bá»™ resource.
    
- **PATCH**: Cáº­p nháº­t má»™t pháº§n cá»§a resource.
    
- **DELETE**: XÃ³a resource.
    
- **OPTIONS**: Xem cÃ¡c phÆ°Æ¡ng thá»©c HTTP mÃ  server há»— trá»£.
    
- **HEAD**: Láº¥y thÃ´ng tin header mÃ  khÃ´ng cÃ³ thÃ¢n dá»¯ liá»‡u.
    

Má»—i phÆ°Æ¡ng thá»©c nÃ y Ä‘Æ°á»£c xá»­ lÃ½ báº±ng cÃ¡c decorator nhÆ° `@app.get()`, `@app.post()`, `@app.put()`, v.v.


---
- API Ä‘i tá»« trÃªn xuá»‘ng dÆ°á»›i, báº¯t Ä‘Ãºng tháº±ng cá»§a nÃ³ 
example 

- unitest lÃ  hÃ m test ko dÃ¹ng bÃªn thá»© 3, database, ,... 
![[Pasted image 20250418203421.png]]
![[Pasted image 20250418204251.png]]

```
response time, má»©c Ä‘á»™ chá»‹u táº£i (bao nhiÃªu user call tá»›i 1 lÃºc) , ... áº¡
```

```
- CÃ¡c yáº¿u tá»‘ nÃ o áº£nh hÆ°á»Ÿng Ä‘áº¿n sá»©c chá»‹u táº£i cá»§a 1 FastAPI áº¡.  
    
- ThÃ´ng thÆ°á»ng lÃ  bao nhiÃªu áº¡.  
    
- NgÃ´n ngá»¯ code cÃ³ áº£nh hÆ°á»Ÿng nhÆ° tháº¿ nÃ o Ä‘áº¿n response time vÃ  Ä‘á»™ chá»‹u táº£i áº¡.  
    

(cháº³ng háº¡n java script, python) áº¡.
```

Load test : What is the upper limit? Bao nhiÃªu ngÆ°á»i vÃ o cÃ¹ng lÃºc ? 
Stress test : How the system reacts under unexpected load?

```
- CÃ¡c yáº¿u tá»‘ nÃ o áº£nh hÆ°á»Ÿng Ä‘áº¿n sá»©c chá»‹u táº£i cá»§a 1 FastAPI áº¡.  
    +, resource 
    +, coding: 
- ThÃ´ng thÆ°á»ng stress test lÃ  bao nhiÃªu áº¡.  
    
- NgÃ´n ngá»¯ code cÃ³ áº£nh hÆ°á»Ÿng nhÆ° tháº¿ nÃ o Ä‘áº¿n response time vÃ  Ä‘á»™ chá»‹u táº£i áº¡.  
    => CÃ³, python ko nhanh báº±ng ngÃ´n ngá»¯ khÃ¡c 

(cháº³ng háº¡n java script, python) áº¡.
```

```
Cáº¥u hÃ¬nh vá» workers, sá»‘ lÆ°á»£ng threads vÃ  cÃ¡c tham sá»‘ khÃ¡c áº£nh hÆ°á»Ÿng lá»›n Ä‘áº¿n hiá»‡u suáº¥t. CPU, RAM, Bandwidth
```

- K6, jimenter, locuts
```
ngoÃ i response time thÃ¬ cÃ²n measure nÃ o khÃ¡c hay Ä‘Æ°á»£c dÃ¹ng k sÃ­p?
=> Concurrent users, Error rate, Latency percentiles cháº¯c v Ã¡ báº¡n
```
- RPS: request/second 
![[Pasted image 20250418205754.png]]

```
1000 thá»i Ä‘iá»ƒm 

1000 user => thÃ¬ response time váº«n bÃ¬nh thÆ°á»ng.  
1500 user vÃ o cÃ¹ng lÃºc thÃ¬ 1000 user Ä‘Æ°á»£c cháº¡y cÃ¹ng lÃºc, 500 user lÃºc Ä‘Ã³ pháº£i Ä‘á»£i => nÃªn lÃ  response time cá»§a 500 user nÃ y sáº½ bá»‹ tÄƒng Ä‘Ãºng ko áº¡. ğŸ˜

=> Äá»©c Huy Tráº§n: @CÆ°á»ng ÄoÃ n Ngá»c náº¿u cÃ³ chÆ¡i lol Ä‘Ã£ tá»«ng tháº¥y cÃ³ thá»i Ä‘iá»ƒm pháº£i Ä‘á»£i tÃ¬m tráº­n tá»›i máº¥y chá»¥c phÃºt =))))
```

[JMeter vs. Locust vs. k6 Comparison](https://sourceforge.net/software/compare/JMeter-vs-Locust-vs-k6/)


![[Pasted image 20250418210223.png]]
1. Giáº£m data size 
2. Auto services: khi mÃ  sá»‘ lÆ°á»£ng vÃ o tá»± táº¡o thÃªm mÃ¡y, tá»± scales 
3. Caching: K8s: 
	- Sá»­ dá»¥ng Cache trong FastAPI vá»›i Python's `functools.lru_cache`
	- Redis cho Caching
=> Log láº¡i. Decorator Ä‘á»ƒ log? (input, output, response time)

---
Sercurity FastAPI 

https://fastapi.tiangolo.com/tutorial/security/#openapi

![[Pasted image 20250418212851.png]]


![[Pasted image 20250418212903.png]]


---
# FastAPI : 

21/05/2025 

> Trong quÃ¡ trÃ¬nh nghe giáº£ng, em cÃ³ note láº¡i Ä‘Æ°á»£c khoáº£ng 50% lá»i chá»‰ dáº¡y cá»§a sáº¿p NguyÃªn vÃ  note láº¡i. Mong mn Ä‘á»c Ä‘Æ°á»£c nhiá»u Ä‘iá»u cáº§n thiáº¿t vÃ  nhá» cÃ¡c sáº¿p, cÃ¡c ace bá»• sung thÃªm cho dÃ i hÆ¡n áº¡ :v Thank everyon so much!

> GÃ³c vui váº»: TrÆ°á»›c em Ä‘i thá»±c táº­p 6 thÃ¡ng toÃ n Flask, ko biáº¿t FastAPI luÃ´n. MÃ£i sau cÃ³ Ä‘á»©a báº¡n báº£o sao ko dÃ¹ng FastAPI em má»›i chuyá»ƒn sang thá»­. vÃ  ui, FastAPI cÃ³ /docs Ä‘á»ƒ xem ngay cÃ¡c API Ä‘Æ°á»£c define bÃªn trong lÃ  gÃ¬!!!

`
## 1. ThÆ°á»ng dÃ¹ng nháº¥t lÃ : GET vÃ  POST 
```
from fastapi import FastAPI

app = FastAPI()

# HÃ m Ä‘Æ¡n giáº£n Ä‘á»ƒ tráº£ vá» má»™t thÃ´ng Ä‘iá»‡p
@app.get("/greet")
def greet():
    return {"message": "Hello, welcome to FastAPI!"}
    
@app.get("/items")
def get_items():
    return {"items": ["item1", "item2", "item3"]}
    
@app.post("/create_item")
def create_item(item: dict):
    return {"message": "Item created", "item": item}
```

CÃ¡c HTTP methods khÃ¡c nhÆ°:

- **GET**: Láº¥y thÃ´ng tin tá»« server.
- **POST**: Gá»­i dá»¯ liá»‡u Ä‘á»ƒ táº¡o má»›i resource.
- **PUT**: Cáº­p nháº­t toÃ n bá»™ resource.
- **PATCH**: Cáº­p nháº­t má»™t pháº§n cá»§a resource.
- **DELETE**: XÃ³a resource.
- **OPTIONS**: Xem cÃ¡c phÆ°Æ¡ng thá»©c HTTP mÃ  server há»— trá»£.
- **HEAD**: Láº¥y thÃ´ng tin header mÃ  khÃ´ng cÃ³ thÃ¢n dá»¯ liá»‡u.

## 2. The Testing Pyramid: The Key to Efficient Software Engineering 
1. Unit tests: individual components or functions. 
do not involve third-party services like databases.
2. Integration tests: how different modules or services work together.
3. Eng-to-end tests
## 3. Sá»©c chá»‹u táº£i

### 3.1 KhÃ¡i niá»‡m 
Load test : What is the upper limit? Bao nhiÃªu ngÆ°á»i vÃ o cÃ¹ng lÃºc ? 
Stress test : How the system reacts under unexpected load?

áº¢nh cho tháº¥y: 
- API hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng khi cÃ³ 1000 user Ä‘á»“ng thá»i
- API cÃ³ Ä‘á»™ trá»… khi cÃ³ 1500 user Ä‘á»“ng thá»i (1000 user bÃ¬nh thÆ°á»ng, 500 user pháº£i Ä‘á»£i)
- API gÃ£y khi 2000 user Ä‘á»“ng thá»i. 

### 3.2 CÃ¡c yáº¿u tá»‘ nÃ o áº£nh hÆ°á»Ÿng Ä‘áº¿n sá»©c chá»‹u táº£i cá»§a 1 FastAPI áº¡.  
Gá»“m 2 yáº¿u tá»‘: 
1. LÃ  resource: CPU, RAM, BÄƒng thÃ´ng máº¡ng, ... 
2. LÃ  coding: Thiáº¿t káº¿ kiáº¿n trÃºc tá»‘i Æ°u, quáº£n lÃ½ káº¿t ná»‘i, xá»­ lÃ½ báº¥t Ä‘á»“ng bá»™, ...

### 3.3 LÃ m sao Ä‘á»ƒ Ä‘o lÆ°á»ng sá»©c chá»‹u táº£i 

- Tool Ä‘á»ƒ Ä‘o sá»©c chá»‹u táº£i: [JMeter vs. Locust vs. k6 Comparison](https://sourceforge.net/software/compare/JMeter-vs-Locust-vs-k6/)

### 3.4 Improve API Performance: 
- Auto services: khi mÃ  sá»‘ lÆ°á»£ng vÃ o tá»± táº¡o thÃªm mÃ¡y, tá»± scales (K8s, ...)
- Caching: 
	- Sá»­ dá»¥ng Cache trong FastAPI vá»›i Python's `functools.lru_cache`
	- Redis cho Caching
## 4. Sercurity FastAPI 

https://fastapi.tiangolo.com/tutorial/security/#openapi



---
Viáº¿t bÃ i: https://www.linkedin.com/posts/doan-ngoc-cuong_doanngoccuong-fullstackdatascience-wecommit100x-activity-7320136100667146241-hGIl?utm_source=social_share_send&utm_medium=member_desktop_web&rcm=ACoAAC3wojwBYfkOk3q0b6y8Z_UF_N5ELvjQYVI

Link: [FAST API - B6 | FSDS](https://fullstackdatascience.com/courses/k6-mlops-1-gc5a2p/topic/119)


---

# GÃ³c há»i Ä‘Ã¡p: 

```
[Em há»i vá» MONITORING API].  
  
a KhiÃªm Æ¡i, bÃ i App The Coach Má»›i.  
Em deploy háº¿t API lÃªn rá»“i.  
----  
1. LÃ : Giá» lÃªn Production thÃ¬ trÆ°á»›c mn xÃ i gÃ¬ Ä‘á»ƒ MONITORING API tháº¿ áº¡. Em cÃ³ cáº§n tá»± triá»ƒn khai khÃ´ng hay lÃ  khi giao API cho bÃªn Backend. Chá»— Backend cÃ³ tool MONITORING API chung rá»“i áº¡.  
2. LÃ  náº¿u em tá»± triá»ƒn khai thÃ¬ anh cÃ³ gá»£i Ã½ tool nÃ o monitoring ko áº¡.  
  
Em cáº£m Æ¡n anh
```

```
1. anh hay dÃ¹ng locust =)) k6 hay dÃ¹ng cho go, jmeter java
    
2. _[_2:42 PM_]_
    
    cÆ¡ mÃ 
    
3. _[_2:42 PM_]_
    
    máº¥y tool kia Ä‘á»ƒ load/stress test mÃ  nhá»‰
    
4. _[_2:42 PM_]_
    
    monitor thÃ¬ cÃ³ nhiá»u thá»© láº¯m, xoanh quanh 3 cÃ¡i chÃ­nh lÃ  logs, metrics vÃ  traces nha
    
    ![pepecringe](https://cdn.discordapp.com/emojis/1247827442736037888.webp?size=56)
    
    1
    
5. ![](https://cdn.discordapp.com/avatars/601095875925901312/bda79e313bbb8b995822abb139de7fc3.webp?size=100)
    
    ### adrien_long _â€”_ 2:43 PM
    
    Láº¡i bá»• sung thÃªm vÃ o code ná»¯a Ã 
    
6. _[_2:43 PM_]_
    
    ![:pepecringe:](https://cdn.discordapp.com/emojis/1247827442736037888.webp?size=128)
    
7. ![](https://cdn.discordapp.com/avatars/827755428728930364/39234351505e1c7b1c8e9dbf8752d4a9.webp?size=100)
    
    ### quandv _â€”_ 2:43 PM
    
    Ä‘Ãºng Ã²i, sáº½ há»c á»Ÿ bÃ i observable system sáº¿p nhÃ©
    
    ![pepepray](https://cdn.discordapp.com/emojis/1244838094457274398.webp?size=56)
    
    2
    
8. ![](https://cdn.discordapp.com/avatars/601095875925901312/bda79e313bbb8b995822abb139de7fc3.webp?size=100)
    
    ### adrien_long _â€”_ 2:45 PM
    
    Cá»© hnao code hÃ²m hÃ²m xong rá»“i lÃªn group Ä‘á»c láº¡i lÃºi hÃºi sá»­a
    
    ![ğŸ¥²](https://discord.com/assets/69aa309e02aeb2c4.svg)
    
    1
    
9. ![](https://cdn.discordapp.com/avatars/827755428728930364/39234351505e1c7b1c8e9dbf8752d4a9.webp?size=20)@quandv
    
    monitor thÃ¬ cÃ³ nhiá»u thá»© láº¯m, xoanh quanh 3 cÃ¡i chÃ­nh lÃ  logs, metrics vÃ  traces nha
    
    ![](https://cdn.discordapp.com/avatars/887982602856845312/368740c13e5cbfaf3a1236c10f2ecc30.webp?size=100)
    
    ### ÄoÃ n Ngá»c CÆ°á»ng - AI _â€”_ 2:47 PM
    
    sáº¿p QuÃ¢n gá»£i Ã½ framework nÃ o MONITORING API ko áº¡. ![:pepepray~1:](https://cdn.discordapp.com/emojis/1244838094457274398.webp?size=56)
    
10. _[_2:47 PM_]_
    
    gáº¥p sáº¿p áº¡ ![:stronge:](https://cdn.discordapp.com/emojis/1247827449551523862.webp?size=56)
    
11. ![](https://cdn.discordapp.com/avatars/827755428728930364/39234351505e1c7b1c8e9dbf8752d4a9.webp?size=100)
    
    ### quandv _â€”_ 2:48 PM
    
    opentelemetry + prometheus&grafana (metrics) + elk (logs) + jaeger (traces)
    
    ![partyhatsmiwe](https://cdn.discordapp.com/emojis/1247827444770279445.webp?size=56)
    
    1
    
    ![â¤ï¸](https://discord.com/assets/8838f014a5d2ce59.svg)
    
    1
    
12. ![](https://cdn.discordapp.com/avatars/887982602856845312/368740c13e5cbfaf3a1236c10f2ecc30.webp?size=100)
    
    ### ÄoÃ n Ngá»c CÆ°á»ng - AI _â€”_ 2:50 PM
    
    Äá»™i Æ¡n anh, Ä‘á»ƒ em search ![ğŸ˜„](https://discord.com/assets/58a76b2430663605.svg)
    

new

14. ![](https://cdn.discordapp.com/avatars/827755428728930364/39234351505e1c7b1c8e9dbf8752d4a9.webp?size=100)
    
    ### quandv _â€”_ 2:51 PM
    
    k dÃ¡m
    

Message #k6-mlops-1
```

```
anh hay dÃ¹ng locust =)) k6 hay dÃ¹ng cho go, jmeter java
opentelemetry + prometheus&grafana (metrics) + elk (logs) + jaeger (traces)
```

## opentelemetry + prometheus&grafana (metrics) + elk (logs) + jaeger (traces)

# ğŸ” OpenTelemetry (OTEL) - Há»‡ thá»‘ng Observability

## ğŸ“– **OpenTelemetry lÃ  gÃ¬?**

**OpenTelemetry** (viáº¿t táº¯t **OTEL**) lÃ  má»™t **open-source observability framework** Ä‘Æ°á»£c táº¡o ra Ä‘á»ƒ giÃºp developers **monitor, trace vÃ  debug** cÃ¡c á»©ng dá»¥ng phÃ¢n tÃ¡n (distributed systems).

### **3 Pillars cá»§a Observability:**

1. **ğŸ“Š Metrics** - Äo lÆ°á»ng hiá»‡u suáº¥t (CPU, memory, response time)
2. **ğŸ“ Logs** - Ghi láº¡i events vÃ  errors
3. **ğŸ”— Traces** - Theo dÃµi requests qua nhiá»u services


### 3.1 - Cáº§n giÃ¡m sÃ¡t nhá»¯ng cÃ¡i gÃ¬? (metrics, logs, traces), lÃ  gÃ¬? bá» Ä‘i cÃ¡i nÃ o Ä‘Æ°á»£c ko, cÃ²n thiáº¿u cÃ¡i nÃ o ko Khi nÃ o thÃ¬ cáº§n cÃ¡i nÃ o?

 âœ… **Ba trá»¥ cá»™t giÃ¡m sÃ¡t há»‡ thá»‘ng**

| Loáº¡i        | Má»¥c Ä‘Ã­ch chÃ­nh                                      | DÃ¹ng khi nÃ o?                              | CÃ´ng cá»¥ sá»­ dá»¥ng                                      |
|-------------|-----------------------------------------------------|--------------------------------------------|------------------------------------------------------|
| **Metrics** | Äo lÆ°á»ng sá»©c khá»e há»‡ thá»‘ng (CPU, error rate, request/s) | LuÃ´n nÃªn dÃ¹ng Ä‘á»ƒ giÃ¡m sÃ¡t tá»•ng quan         | OpenTelemetry + Prometheus + Grafana                 |
| **Logs**    | Ghi láº¡i sá»± kiá»‡n chi tiáº¿t (lá»—i, hÃ nh vi ngÆ°á»i dÃ¹ng) | Khi cáº§n debug, theo dÃµi chi tiáº¿t            | Winston + Logstash + Elasticsearch + Kibana          |
| **Traces**  | Theo dÃµi luá»“ng xá»­ lÃ½ request (tÃ¬m chá»— cháº­m, bottleneck) | Khi cÃ³ nhiá»u API/service                    | OpenTelemetry + Jaeger                               |
| **Auto tracking** | Tá»± Ä‘á»™ng theo dÃµi                               |                                            | @opentelemetry/auto-instrumentations-node            |

---

  

## 3. CÃ¡c bÆ°á»›c triá»ƒn khai

  

### BÆ°á»›c 1: CÃ i Ä‘áº·t cÃ¡c package cáº§n thiáº¿t

  

Cháº¡y lá»‡nh sau trong thÆ° má»¥c `backend`:

  

```bash

npm install @opentelemetry/api \

Â  Â  Â  Â  Â  Â  @opentelemetry/sdk-node \

Â  Â  Â  Â  Â  Â  @opentelemetry/auto-instrumentations-node \

Â  Â  Â  Â  Â  Â  @opentelemetry/exporter-prometheus \

Â  Â  Â  Â  Â  Â  @opentelemetry/exporter-jaeger \

Â  Â  Â  Â  Â  Â  @opentelemetry/resources \

Â  Â  Â  Â  Â  Â  @opentelemetry/semantic-conventions \

Â  Â  Â  Â  Â  Â  @opentelemetry/sdk-metrics \

Â  Â  Â  Â  Â  Â  @opentelemetry/sdk-trace-node \

Â  Â  Â  Â  Â  Â  winston

```

  

---

  

### BÆ°á»›c 2: Táº¡o file cáº¥u hÃ¬nh OpenTelemetry

  

Táº¡o file `src/otel.js` vá»›i ná»™i dung:

  

```js

const { NodeSDK } = require('@opentelemetry/sdk-node');

const { PrometheusExporter } = require('@opentelemetry/exporter-prometheus');

const { JaegerExporter } = require('@opentelemetry/exporter-jaeger');

const { getNodeAutoInstrumentations } = require('@opentelemetry/auto-instrumentations-node');

  

const prometheusExporter = new PrometheusExporter({ port: 9464 });

const jaegerExporter = new JaegerExporter({

Â  endpoint: 'http://localhost:14268/api/traces',

Â  serviceName: 'backend-api-service',

});

  

const sdk = new NodeSDK({

Â  traceExporter: jaegerExporter,

Â  metricExporter: prometheusExporter,

Â  instrumentations: [getNodeAutoInstrumentations()],

});

  

sdk.start();

```

  

---

  

### BÆ°á»›c 3: TÃ­ch há»£p vÃ o app Express

  

- ThÃªm dÃ²ng `require('./src/otel')` vÃ o Ä‘áº§u file `src/server.js` (trÆ°á»›c khi táº¡o app Express):

  

```js

require('./src/otel');

const express = require('express');

// ... cÃ¡c dÃ²ng khÃ¡c ...

```

  

---

  

### BÆ°á»›c 4: TÃ­ch há»£p logging vá»›i Winston

  

Táº¡o file `src/logger.js`:

  

```js

const winston = require('winston');

  

const logger = winston.createLogger({

Â  level: 'info',

Â  format: winston.format.json(),

Â  transports: [

Â  Â  new winston.transports.Console(),

Â  ],

});

  

module.exports = logger;

```

  

- Thay tháº¿ cÃ¡c dÃ²ng `console.log` trong code báº±ng `logger.info`, `logger.error`, v.v.

  

---

  

### BÆ°á»›c 5: Cáº¥u hÃ¬nh Prometheus

  

- ThÃªm vÃ o file cáº¥u hÃ¬nh Prometheus:

  

```yaml

scrape_configs:

Â  - job_name: 'nodejs-backend'

Â  Â  static_configs:

Â  Â  Â  - targets: ['localhost:9464']

```

  

- Truy cáº­p metrics táº¡i: [http://localhost:9464/metrics](http://localhost:9464/metrics)

- Káº¿t ná»‘i Prometheus vá»›i Grafana Ä‘á»ƒ váº½ dashboard.

  

---

  

### BÆ°á»›c 6: Cáº¥u hÃ¬nh Jaeger

  

- Cháº¡y Jaeger báº±ng Docker:

  

```bash

docker run -d --name jaeger \

Â  -e COLLECTOR_ZIPKIN_HTTP_PORT=9411 \

Â  -p 16686:16686 \

Â  -p 14268:14268 \

Â  jaegertracing/all-in-one:latest

```

  

- Truy cáº­p Jaeger UI táº¡i: [http://localhost:16686](http://localhost:16686)

  

---

  

### BÆ°á»›c 7: Cáº¥u hÃ¬nh ELK Stack cho logging

  

- CÃ i Ä‘áº·t Logstash, Elasticsearch, Kibana (tham kháº£o tÃ i liá»‡u chÃ­nh thá»©c).

- Cáº¥u hÃ¬nh Logstash Ä‘á»c log tá»« STDOUT hoáº·c file log cá»§a Winston, gá»­i sang Elasticsearch.

- DÃ¹ng Kibana Ä‘á»ƒ xem log.

  

---

  

## 4. Kiá»ƒm thá»­

  

- Gá»i thá»­ cÃ¡c API, kiá»ƒm tra metrics á»Ÿ Prometheus, dashboard á»Ÿ Grafana.

- Kiá»ƒm tra trace á»Ÿ Jaeger.

- Kiá»ƒm tra log á»Ÿ Kibana.

  

---

  

## 5. Ghi chÃº

  

- Äáº£m báº£o gá»i `require('./src/otel')` trÆ°á»›c khi import cÃ¡c module khÃ¡c Ä‘á»ƒ tracking tá»± Ä‘á»™ng hoáº¡t Ä‘á»™ng Ä‘Ãºng.

- CÃ³ thá»ƒ má»Ÿ rá»™ng thÃªm alert (cáº£nh bÃ¡o) trÃªn Grafana hoáº·c Prometheus khi cÃ³ lá»—i hoáº·c hiá»‡u nÄƒng kÃ©m.

  

---

  

## 6. TÃ i liá»‡u tham kháº£o

  

- [OpenTelemetry Node.js](https://opentelemetry.io/docs/instrumentation/js/)

- [Prometheus](https://prometheus.io/docs/introduction/overview/)

- [Grafana](https://grafana.com/docs/)

- [Jaeger](https://www.jaegertracing.io/docs/)

- [ELK Stack](https://www.elastic.co/what-is/elk-stack)

- [Winston Logger](https://github.com/winstonjs/winston)

  

---

  

**Done!** Â 

Náº¿u cáº§n file máº«u hoáº·c hÆ°á»›ng dáº«n chi tiáº¿t hÆ¡n cho tá»«ng bÆ°á»›c, hÃ£y há»i nhÃ©!



---

# ğŸ” Full Observability Stack - "The Golden Standard"  - 18092025 - khi lÃ m bÃ i CFO AI Agent

ÄÃ¢y lÃ  **bá»™ cÃ´ng cá»¥ monitoring/observability hoÃ n chá»‰nh** Ä‘Æ°á»£c sá»­ dá»¥ng rá»™ng rÃ£i trong cÃ¡c há»‡ thá»‘ng production lá»›n!

---

## ğŸ—ï¸ **Architecture Overview**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Application   â”‚â”€â”€â”€â–¶â”‚  OpenTelemetry   â”‚â”€â”€â”€â–¶â”‚  Export & Store â”‚
â”‚  (AI Financial) â”‚    â”‚   (Collector)    â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼           â–¼           â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Metrics  â”‚ â”‚   Logs   â”‚ â”‚  Traces  â”‚
            â”‚Prometheus â”‚ â”‚ELK Stack â”‚ â”‚ Jaeger   â”‚
            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                  â–¼            â–¼            â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Grafana  â”‚ â”‚  Kibana  â”‚ â”‚ Jaeger   â”‚
            â”‚Dashboard â”‚ â”‚Dashboard â”‚ â”‚   UI     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© **CÃ¡c thÃ nh pháº§n chi tiáº¿t**

### 1. **ğŸ¯ OpenTelemetry - "Data Collector"**

```yaml
Role: Thu tháº­p vÃ  xuáº¥t dá»¯ liá»‡u tá»« á»©ng dá»¥ng
Function: 
  - Auto-instrument code
  - Collect metrics, logs, traces
  - Export to multiple backends
```

### 2. **ğŸ“Š Prometheus + Grafana - "Metrics Stack"**

#### **Prometheus (Database)**

```yaml
What: Time-series database cho metrics
Stores:
  - CPU usage over time
  - Memory consumption  
  - Request per second
  - Custom business metrics
  
Example Metrics:
  - ai_agent_response_time_seconds
  - financial_calculations_total
  - database_connections_active
```

#### **Grafana (Visualization)**

```yaml
What: Dashboard platform
Features:
  - Beautiful charts & graphs
  - Real-time monitoring
  - Alerting system
  - Custom dashboards
```

### 3. **ğŸ“ ELK Stack - "Logs Management"**

#### **E - Elasticsearch**

```yaml
What: Search & analytics engine
Stores: All application logs
Features:
  - Full-text search
  - Log aggregation
  - Fast queries
```

#### **L - Logstash**

```yaml
What: Log processing pipeline
Function:
  - Collect logs from multiple sources
  - Parse & transform logs
  - Send to Elasticsearch
```

#### **K - Kibana**

```yaml
What: Log visualization & search UI
Features:
  - Search through millions of logs
  - Create log dashboards
  - Set up log-based alerts
```

### 4. **ğŸ”— Jaeger - "Distributed Tracing"**

```yaml
What: Tracing system
Tracks: Request journey across services
Features:
  - Trace visualization
  - Performance bottleneck detection
  - Dependency mapping
```

---

## ğŸ’° **Trong há»‡ thá»‘ng AI Financial cá»§a báº¡n**

### **ğŸ“Š Metrics vá»›i Prometheus + Grafana:**

```python
# VÃ­ dá»¥ metrics cÃ³ thá»ƒ track
ai_cfo_agent_requests_total = Counter('ai_cfo_requests_total')
financial_calculation_duration = Histogram('financial_calc_duration_seconds')
active_agents_gauge = Gauge('active_agents_count')
database_query_errors = Counter('db_query_errors_total')
```

**Dashboard cÃ³ thá»ƒ cÃ³:**

- Real-time agent performance
- Financial calculation trends
- System resource usage
- Business KPIs

### **ğŸ“ Logs vá»›i ELK Stack:**

```json
// Logs sáº½ Ä‘Æ°á»£c structured vÃ  searchable
{
  "timestamp": "2025-09-18T00:34:33.194Z",
  "level": "info", 
  "event": "Agent initialized",
  "agent_id": "ai_cfo_agent",
  "capabilities": 10,
  "duration_ms": 250
}
```

**Kibana cÃ³ thá»ƒ:**

- Search "all errors in last 24h"
- Filter "AI CFO agent activities"
- Create alerts for critical errors

### **ğŸ”— Traces vá»›i Jaeger:**

```
User Request: "Calculate financial ratios"
â”œâ”€â”€ FastAPI Handler (50ms)
â”œâ”€â”€ Agent Orchestrator (30ms)
â”œâ”€â”€ AI CFO Agent (200ms)
â”‚   â”œâ”€â”€ OpenAI API Call (150ms)
â”‚   â””â”€â”€ Financial Calculation (50ms)
â”œâ”€â”€ Database Query (100ms)
â””â”€â”€ Response Assembly (20ms)
Total: 450ms
```

---

## ğŸ› ï¸ **Setup cho project cá»§a báº¡n**

### **Docker Compose Example:**

```yaml
version: '3.8'
services:
  # Your AI Financial App
  ai-financial:
    build: .
    environment:
      - OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4317
  
  # OpenTelemetry Collector
  otel-collector:
    image: otel/opentelemetry-collector:latest
    
  # Metrics Stack
  prometheus:
    image: prom/prometheus:latest
    ports: ["9090:9090"]
    
  grafana:
    image: grafana/grafana:latest
    ports: ["3000:3000"]
  
  # Logs Stack  
  elasticsearch:
    image: elasticsearch:8.0.0
    ports: ["9200:9200"]
    
  kibana:
    image: kibana:8.0.0
    ports: ["5601:5601"]
    
  # Tracing
  jaeger:
    image: jaegertracing/all-in-one:latest
    ports: ["16686:16686"]
```

---

## ğŸ“ˆ **Benefits cho AI Financial System**

### **ğŸ¯ Business Intelligence:**

- **Financial KPIs:** Track calculation accuracy, processing time
- **Agent Performance:** Monitor which agents are most/least effective
- **User Behavior:** Understand usage patterns

### **ğŸ”§ Technical Operations:**

- **Performance:** Identify slow components
- **Reliability:** Monitor error rates, uptime
- **Scaling:** Understand resource needs

### **ğŸš¨ Proactive Monitoring:**

- **Alerts:** Notify when agents fail or respond slowly
- **Trends:** Predict when to scale infrastructure
- **Debugging:** Quickly find root cause of issues

---

## ğŸ¯ **TÃ³m láº¡i**

**ÄÃ¢y lÃ  "Rolls Royce" cá»§a monitoring systems:**

- **OpenTelemetry** = ğŸš— Engine (thu tháº­p data)
- **Prometheus + Grafana** = ğŸ“Š Speedometer (metrics & charts)
- **ELK Stack** = ğŸ“ Black Box (logs & events)
- **Jaeger** = ğŸ—ºï¸ GPS (trace requests)

**Perfect cho production AI systems** nhÆ° cá»§a báº¡n vÃ¬ cÃ³ thá»ƒ monitor má»i thá»© tá»« AI model performance Ä‘áº¿n business metrics! ğŸš€

**Cost:** Free (all open-source) nhÆ°ng cáº§n infrastructure Ä‘á»ƒ run.