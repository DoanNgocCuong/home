```
â€¦ /deploy] â””4 <base> main(+15/-0,+10/-11)* Â± sudo docker compose down [+] Running 2/2 âœ” Container 30005-dev-job-search-rag-api Removed 0.8s ! Network deploy_default Resource is still in use 0.0s Î¸75Â° 2d [ubuntu@mgc-dev2-3090:~/cuong_dn/MiniProd_Web4_ContentEngFlow_StepUpE_T102024/Î¸75Â° 2d [ubuntu@mgc-dev2-3090:~/cuong_dn/MiniProd_Web4_ContentEngFlow_StepUpE_T102024/ â€¦ /de ploy]â””4 <base> main(+15/-0,+10/-11)* Â± network máº·c Ä‘á»‹nh lÃ  sao
```

Khi báº¡n cháº¡y lá»‡nh:

`sudo docker compose down`

vÃ  tháº¥y thÃ´ng bÃ¡o:

`âœ” Container <...> Removed ! Network deploy_default Resource is still in use`

thÃ¬ Ä‘iá»u nÃ y cÃ³ nghÄ©a lÃ :

---

### âœ… **Giáº£i thÃ­ch "network máº·c Ä‘á»‹nh":**

Trong Docker Compose, náº¿u báº¡n **khÃ´ng khai bÃ¡o rÃµ rÃ ng má»™t máº¡ng (`networks`)** trong file `docker-compose.yml`, thÃ¬ Docker sáº½ **tá»± Ä‘á»™ng táº¡o má»™t máº¡ng "máº·c Ä‘á»‹nh" (default network)** cho cÃ¡c container trong project Ä‘Ã³.

TÃªn máº·c Ä‘á»‹nh cá»§a network nÃ y thÆ°á»ng cÃ³ dáº¡ng:

`<folder-name>_default`

VÃ­ dá»¥:  
Náº¿u thÆ° má»¥c chá»©a `docker-compose.yml` cá»§a báº¡n lÃ  `deploy`, thÃ¬ Docker Compose sáº½ tá»± táº¡o network tÃªn lÃ  `deploy_default`.

---

### âš ï¸ **Táº¡i sao network váº«n â€œin useâ€?**

LÃ½ do dÃ²ng:

`! Network deploy_default Resource is still in use`

xuáº¥t hiá»‡n lÃ  vÃ¬ **Docker tháº¥y váº«n cÃ²n container nÃ o Ä‘Ã³ Ä‘ang dÃ¹ng network nÃ y**. Má»™t sá»‘ nguyÃªn nhÃ¢n:

- Báº¡n Ä‘ang dÃ¹ng network Ä‘Ã³ trong má»™t container khÃ¡c **khÃ´ng bá»‹ xÃ³a** do khÃ´ng náº±m trong file `docker-compose.yml` hiá»‡n táº¡i.
    
- Má»™t container Ä‘Æ°á»£c táº¡o trÆ°á»›c Ä‘Ã³ thá»§ cÃ´ng (`docker run`) cÃ³ gÃ¡n network Ä‘Ã³.
    
- Docker gáº·p lá»—i khi cleanup, Ä‘Ã´i khi chá»‰ cáº§n Ä‘á»£i vÃ i giÃ¢y hoáº·c thá»­ láº¡i.


Trong trÆ°á»ng há»£p cá»§a báº¡n, network `prod_deploy_default` **khÃ´ng pháº£i do má»i ngÆ°á»i tá»± Ä‘áº·t tÃªn** mÃ  do **Docker Compose tá»± Ä‘á»™ng sinh ra**.

CÆ¡ cháº¿ lÃ :

- Khi báº¡n cháº¡y `docker compose up` trong má»™t thÆ° má»¥c cÃ³ file `docker-compose.yml`, Docker Compose sáº½ táº¡o má»™t **project name** (theo máº·c Ä‘á»‹nh lÃ  tÃªn thÆ° má»¥c, á»Ÿ Ä‘Ã¢y lÃ  `prod_deploy`).
    
- Sau Ä‘Ã³ nÃ³ sinh ra network máº·c Ä‘á»‹nh cho cÃ¡c service, tÃªn lÃ :
    
    ```
    <project_name>_default
    ```
    
    â†’ tá»©c lÃ  `prod_deploy_default`.
    

ğŸ‘‰ VÃ¬ váº­y:

- Náº¿u báº¡n **khÃ´ng Ä‘á»‹nh nghÄ©a network** trong `docker-compose.yml`, Docker sáº½ tá»± táº¡o má»™t network default nhÆ° trÃªn.
    
- Náº¿u muá»‘n cÃ³ tÃªn khÃ¡c hoáº·c subnet rÃµ rÃ ng, báº¡n cÃ³ thá»ƒ tá»± Ä‘á»‹nh nghÄ©a trong `docker-compose.yml`, vÃ­ dá»¥:
    
    ```yaml
    networks:
      my_custom_network:
        driver: bridge
        ipam:
          config:
            - subnet: 10.123.0.0/16
    ```
    

Sau Ä‘Ã³ gÃ¡n service vÃ o:

```yaml
services:
  api:
    build: .
    networks:
      - my_custom_network
```

---

Báº¡n cÃ³ muá»‘n mÃ¬nh viáº¿t cho báº¡n má»™t Ä‘oáº¡n cáº¥u hÃ¬nh `docker-compose.yml` máº«u vá»›i network cÃ³ **subnet riÃªng** (Ä‘á»ƒ trÃ¡nh lá»—i overlap nhÆ° trÃªn) khÃ´ng?


```
services:

Â  prod_real-job-search-rag-api:

Â  Â  build: .

Â  Â  container_name: prod_real-job-search-rag-api

Â  Â  ports:

Â  Â  Â  - "30007:30007"

Â  Â  env_file:

Â  Â  Â  - .env

Â  Â  healthcheck:

Â  Â  Â  test: ["CMD", "curl", "-f", "http://localhost:30007/healthz"]

Â  Â  Â  interval: 15s

Â  Â  Â  timeout: 3s

Â  Â  Â  retries: 5

Â  Â  restart: unless-stopped
```



```
[+] Running 3/3
 âœ” prod_real-job-search-rag-api            Built                                                                             0.0s 
 âœ” Network prod_deploy_default             Created                                                                           0.1s 
 âœ” Container prod_real-job-search-rag-api  Started   
```