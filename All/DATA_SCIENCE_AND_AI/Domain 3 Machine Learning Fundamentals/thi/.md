# Bagging 


MÃ¬nh giáº£i thÃ­ch ngáº¯n â€“ dá»… nhá»› nhÃ©.

# Bagging lÃ  gÃ¬ (trong Random Forest)?

 **Bagging = Bootstrap Aggregating** . Ã tÆ°á»Ÿng: táº¡o **nhiá»u bá»™ dá»¯ liá»‡u con** báº±ng cÃ¡ch **láº¥y máº«u cÃ³ hoÃ n láº¡i (bootstrap)** tá»« dá»¯ liá»‡u gá»‘c, huáº¥n luyá»‡n **nhiá»u cÃ¢y** Ä‘á»™c láº­p trÃªn cÃ¡c máº«u nÃ y, rá»“i  **gá»™p dá»± Ä‘oÃ¡n** :

* PhÃ¢n loáº¡i: láº¥y  **Ä‘a sá»‘ phiáº¿u** .
* Há»“i quy: láº¥y  **trung bÃ¬nh** .

# VÃ¬ sao lÃ m váº­y?

* CÃ¡c cÃ¢y há»c tá»« nhá»¯ng máº«u khÃ¡c nhau â†’ **Ã­t tÆ°Æ¡ng quan** vá»›i nhau.
* Khi gá»™p láº¡i,  **phÆ°Æ¡ng sai (variance) giáº£m máº¡nh** , dá»± Ä‘oÃ¡n á»•n Ä‘á»‹nh hÆ¡n â†’ mÃ´ hÃ¬nh Ã­t â€œquÃ¡ khá»›pâ€ hÆ¡n so vá»›i má»™t cÃ¢y Ä‘Æ¡n láº».

# CÃ¡c bÆ°á»›c bagging trong Random Forest

1. Láº·p B láº§n (vÃ­ dá»¥ 100 cÃ¢y):
   * Láº¥y 1 máº«u bootstrap (cÃ¹ng kÃ­ch thÆ°á»›c,  **cÃ³ hoÃ n láº¡i** ).
   * Huáº¥n luyá»‡n má»™t cÃ¢y quyáº¿t Ä‘á»‹nh trÃªn máº«u nÃ y.
   * (Äáº·c trÆ°ng RF cÃ²n **random feature** á»Ÿ má»—i nÃºt: chá»‰ xÃ©t k Ä‘áº·c trÆ°ng ngáº«u nhiÃªn khi tÃ¡ch â€“ Ä‘Ã´i khi gá»i lÃ   *feature bagging* .)
2. Khi dá»± Ä‘oÃ¡n: cho Ä‘iá»ƒm má»›i Ä‘i qua **táº¥t cáº£** cÃ¢y â†’ gá»™p káº¿t quáº£.

# Bonus: OOB (Out-of-Bag)

VÃ¬ láº¥y máº«u cÃ³ hoÃ n láº¡i, khoáº£ng **~36%** Ä‘iá»ƒm gá»‘c **khÃ´ng xuáº¥t hiá»‡n** trong má»—i bootstrap. Ta dÃ¹ng chÃ­nh cÃ¡c Ä‘iá»ƒm â€œbá»‹ bá» quÃªnâ€ nÃ y Ä‘á»ƒ **Ä‘Ã¡nh giÃ¡ sai sá»‘ OOB** â€“ gáº§n nhÆ° má»™t phÃ©p cross-validation â€œmiá»…n phÃ­â€.

# So vá»›i boosting thÃ¬ sao?

* **Bagging** : cÃ¡c cÃ¢y  **Ä‘á»™c láº­p** , gá»™p Ä‘á»ƒ  **giáº£m variance** .
* **Boosting** : cÃ¡c cÃ¢y  **tuáº§n tá»±** , cÃ¢y sau sá»­a lá»—i cÃ¢y trÆ°á»›c â†’  **giáº£m bias** , nhÆ°ng dá»… quÃ¡ khá»›p náº¿u khÃ´ng regularize.

---

Má»™t cÃ¢u check nhanh: theo báº¡n,  **bagging chá»§ yáº¿u giáº£m bias hay giáº£m variance** ? (chá»n má»™t)

Náº¿u thÃ­ch, mÃ¬nh lÃ m luÃ´n má»™t vÃ­ dá»¥ sá»‘ nhá» Ä‘á»ƒ báº¡n tháº¥y rÃµ hiá»‡u á»©ng gá»™p.


---



B. ÄÃºng â€” Random Forest dÃ¹ng bootstrap (má»—i cÃ¢y huáº¥n luyá»‡n trÃªn má»™t máº«u dá»¯ liá»‡u khÃ¡c nhau) Ä‘á»ƒ tÄƒng Ä‘a dáº¡ng.

C. ÄÃºng â€” á» má»—i nÃºt chá»‰ xÃ©t má»™t táº­p con Ä‘áº·c trÆ°ng ngáº«u nhiÃªn (feature bagging), tiáº¿p tá»¥c tÄƒng Ä‘a dáº¡ng giá»¯a cÃ¡c cÃ¢y.

Sao C láº¡i Ä‘Ãºng ?

---

C Ä‘Ãºng vÃ¬ Ä‘Ã¢y chÃ­nh lÃ  â€œfeature baggingâ€ â€“ cÆ¡ cháº¿ cá»‘t lÃµi thá»© hai cá»§a Random Forest.

* á»  **má»—i nÃºt tÃ¡ch** , thay vÃ¬ xÃ©t táº¥t cáº£ (p) Ä‘áº·c trÆ°ng, rá»«ng chá»‰ **láº¥y ngáº«u nhiÃªn má»™t táº­p con** (kÃ­ch thÆ°á»›c (m_\text{try})) Ä‘á»ƒ tÃ¬m split tá»‘t nháº¥t.
* Viá»‡c **giá»›i háº¡n & ngáº«u nhiÃªn hoÃ¡ Ä‘áº·c trÆ°ng** lÃ m cÃ¡c cÃ¢y Ã­t dÃ¹ng cÃ¹ng má»™t Ä‘áº·c trÆ°ng/split â‡’ **giáº£m tÆ°Æ¡ng quan giá»¯a cÃ¢y** â‡’ tÄƒng **Ä‘a dáº¡ng** cá»§a rá»«ng, giÃºp tá»•ng há»£p (bá» phiáº¿u/trung bÃ¬nh) giáº£m phÆ°Æ¡ng sai.

Má»™t vÃ i Ä‘iá»ƒm cá»¥ thá»ƒ:

* Náº¿u cÃ³ má»™t Ä‘áº·c trÆ°ng â€œquÃ¡ máº¡nhâ€, xÃ©t toÃ n bá»™ (p) Ä‘áº·c trÆ°ng sáº½ khiáº¿n **má»i cÃ¢y giá»‘ng nhau** (Ä‘á»u chá»n Ä‘áº·c trÆ°ng Ä‘Ã³ á»Ÿ gáº§n gá»‘c). Giáº£m vá» (m_\text{try}) khiáº¿n Ä‘áº·c trÆ°ng máº¡nh  **Ä‘Ã´i khi khÃ´ng Ä‘Æ°á»£c Ä‘Æ°a vÃ o danh sÃ¡ch xÃ©t** , buá»™c cÃ¢y chá»n hÆ°á»›ng khÃ¡c â†’ Ä‘a dáº¡ng hÆ¡n.
* **Äiá»u chá»‰nh (m_\text{try})** lÃ  nÃºt chá»‰nh â€œÄ‘a dáº¡ng â†” sá»©c máº¡nh cÃ¢yâ€:
  * (m_\text{try}) **nhá»** â†’  **Ä‘a dáº¡ngâ†‘** , tÆ°Æ¡ng quanâ†“ (nhÆ°ng má»—i cÃ¢y yáº¿u hÆ¡n chÃºt).
  * (m_\text{try}) **lá»›n** â†’ cÃ¢y máº¡nh hÆ¡n, nhÆ°ng tÆ°Æ¡ng quanâ†‘, Ä‘a dáº¡ngâ†“.
* Thá»±c táº¿ hay dÃ¹ng:  **classification** : (m_\text{try}\approx \sqrt{p});  **regression** : (m_\text{try}\approx p/3) (chá»‰ lÃ  kinh nghiá»‡m, cÃ³ thá»ƒ tune).

LÆ°u Ã½ vá» cÃ¢u chá»¯: â€œ **thay Ä‘á»•i sá»‘ lÆ°á»£ng Ä‘áº·c trÆ°ng táº¡i má»—i nÃºt** â€ á»Ÿ Ä‘Ã¢y nÃªn hiá»ƒu lÃ  **khÃ´ng xÃ©t toÃ n bá»™ Ä‘áº·c trÆ°ng** mÃ  **chá»‰ xÃ©t má»™t sá»‘ lÆ°á»£ng (mtry) nhá», Ä‘Æ°á»£c chá»n ngáº«u nhiÃªn** á»Ÿ  **má»—i nÃºt** . Sá»‘ lÆ°á»£ng (m_\text{try}) cÃ³ thá»ƒ giá»¯ **cá»‘ Ä‘á»‹nh** cho cáº£ cÃ¢y/rá»«ng (chuáº©n RF), nhÆ°ng  **táº­p Ä‘áº·c trÆ°ng Ä‘Æ°á»£c rÃºt thÄƒm thÃ¬ thay Ä‘á»•i theo tá»«ng nÃºt** , vÃ  chÃ­nh Ä‘iá»u Ä‘Ã³ táº¡o Ä‘a dáº¡ng.


---



Ok, nÃ³i â€œdá»… nuá»‘tâ€ nÃ¨ ğŸ˜„

## VÃ¬ sao C Ä‘Ãºng?

**C: â€œThay vÃ¬ xÃ©t táº¥t cáº£ Ä‘áº·c trÆ°ng, má»—i nÃºt chá»‰ xÃ©t Má»˜T NHÃ“M Äáº¶C TRÆ¯NG NGáºªU NHIÃŠN (mtry).â€**

â†’ ÄÃ¢y gá»i lÃ  **feature bagging** â€“ máº¹o chÃ­nh cá»§a Random Forest Ä‘á»ƒ  **lÃ m cÃ¡c cÃ¢y khÃ¡c nhau** .

### HÃ¬nh dung Ä‘Æ¡n giáº£n

* Náº¿u **xÃ©t táº¥t cáº£ Ä‘áº·c trÆ°ng** á»Ÿ má»i nÃºt, â€œÄ‘áº·c trÆ°ng máº¡nh nháº¥tâ€ sáº½ **luÃ´n** Ä‘Æ°á»£c chá»n á»Ÿ gáº§n gá»‘c â†’ **cÃ¡c cÃ¢y giá»‘ng nhau** â†’ dá»± Ä‘oÃ¡n bá» phiáº¿u cÅ©ngâ€¦ giá»‘ng nhau â‡’  **Ã­t Ä‘a dáº¡ng** .
* Khi **má»—i nÃºt chá»‰ Ä‘Æ°á»£c bá»‘c thÄƒm vÃ i Ä‘áº·c trÆ°ng** (vÃ­ dá»¥ 2 trong tá»•ng 10):
  * Nhiá»u nÃºt **khÃ´ng tháº¥y** Ä‘áº·c trÆ°ng máº¡nh nháº¥t trong danh sÃ¡ch â†’ buá»™c pháº£i chá»n Ä‘áº·c trÆ°ng khÃ¡c.
  * Má»—i cÃ¢y Ä‘i theo **nhÃ¡nh khÃ¡c nhau** â†’ **Ä‘a dáº¡ng** â†‘, **tÆ°Æ¡ng quan giá»¯a cÃ¢y** â†“ â†’ gá»™p láº¡i ( **Ä‘a sá»‘/trung bÃ¬nh** ) sáº½ **á»•n Ä‘á»‹nh hÆ¡n** (giáº£m variance).

### VÃ­ dá»¥ 10s

Giáº£ sá»­ cÃ³ 5 Ä‘áº·c trÆ°ng: A (ráº¥t máº¡nh), B,C,D,E.

* Náº¿u xÃ©t **táº¥t cáº£ 5** á»Ÿ gá»‘c: cÃ¢y nÃ o cÅ©ng chá»n **A** â†’ cÃ¢y na nÃ¡ nhau.
* Náº¿u má»—i nÃºt chá»‰ xÃ©t  **mtry = 2** : Ä‘Ã´i khi gá»‘c **khÃ´ng cÃ³ A** trong danh sÃ¡ch â†’ cÃ¢y Ä‘Ã³ chá»n B hoáº·c Câ€¦ â†’ rá»«ng Ä‘a dáº¡ng.

### Ghi nhá»› nhanh

* **mtry nhá»** â†’ Ä‘a dáº¡ng â†‘ (má»—i cÃ¢y yáº¿u hÆ¡n chÃºt, cáº£ rá»«ng á»•n Ä‘á»‹nh hÆ¡n).
* **mtry lá»›n** â†’ má»—i cÃ¢y máº¡nh hÆ¡n nhÆ°ng giá»‘ng nhau hÆ¡n (Ä‘a dáº¡ng â†“).
* Kinh nghiá»‡m: phÃ¢n loáº¡i dÃ¹ng  **mtry â‰ˆ âˆšp** , há»“i quy dÃ¹ng **mtry â‰ˆ p/3** (tune thÃªm tÃ¹y bÃ i).

=> NÃªn C Ä‘Ãºng, vÃ¬ **giá»›i háº¡n & rÃºt thÄƒm Ä‘áº·c trÆ°ng á»Ÿ má»—i nÃºt** chÃ­nh lÃ  cÃ¡ch Random Forest táº¡o  **Ä‘a dáº¡ng giá»¯a cÃ¡c cÃ¢y** .



---

![1759071136852](image/.md/1759071136852.png)


**B. 4 â†’ 6 â†’ 5 â†’ 1 â†’ 3 â†’ 2.**

* **4** : Táº¡o N bootstrap tá»« dá»¯ liá»‡u gá»‘c.
* **6** : Vá»›i má»—i bootstrap, xÃ¢y má»™t cÃ¢y quyáº¿t Ä‘á»‹nh.
* **5** : á» má»—i nÃºt, chá»n ngáº«u nhiÃªn k (á»Ÿ Ä‘á» lÃ  2) Ä‘áº·c trÆ°ng ( *feature bagging* ).
* **1** : TÃ­nh Gini/Entropy Ä‘á»ƒ chá»n split tá»‘t nháº¥t.
* **3** : (náº¿u theo quy trÃ¬nh Ä‘á» bÃ i) loáº¡i Ä‘áº·c trÆ°ng Ä‘Ã£ chá»n trong nÃºt Ä‘Ã³.
* **2** : Láº·p quÃ¡ trÃ¬nh cho tá»›i khi Ä‘iá»u kiá»‡n dá»«ng thá»a.

---

![1759071289750](image/.md/1759071289750.png)
